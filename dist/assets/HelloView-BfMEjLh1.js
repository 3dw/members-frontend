import{_ as fe,r as m,c as G,o as ge,a as he,a7 as ye,e as o,f as i,t as E,w as I,v as $,F as M,h as P,k as we,g as Ee,n as V,s as Be,a8 as Y,i as r,a9 as _e}from"./index-DnCSe4SK.js";const be={class:"hello-view"},Ae={class:"taiwan-date"},Fe={class:"pond-container"},De={key:0},Re={class:"login-form"},Te={class:"avatar-selection"},Le=["value"],Ue={key:0,class:"avatar"},xe=["src","alt"],ke=["disabled"],Me={key:1},Se={class:"welcome-message"},Ce={key:0,class:"avatar"},je=["src","alt"],ze={key:0,class:"greeting-form"},Ge=["disabled"],Ie={key:1},We={class:"messages-list"},He={key:0,class:"message-item"},qe={class:"message-header"},$e={key:0,class:"avatar"},Pe=["src","alt"],Ve={key:1,class:"avatar"},Ye={class:"username"},Xe={class:"time"},Oe={class:"message-content"},Je={__name:"HelloView",setup(Ne){const X=[{type:"image",src:new URL("/assets/%E4%BD%B3%E4%BB%81%E5%B0%8Ficon-HJEcJM-s.png",import.meta.url).href,value:"jiaren"},{type:"image",src:new URL("/assets/Friday%E5%B0%8Ficon-BaAsUjwf.png",import.meta.url).href,value:"friday"},{type:"image",src:new URL("/assets/%E6%80%9D%E7%90%B4%E5%B0%8Ficon-CEMcz-rY.png",import.meta.url).href,value:"siqin"},{type:"image",src:new URL("/assets/Bestian%E5%B0%8Ficon-DprHiHRR.png",import.meta.url).href,value:"bestian"},{type:"image",src:new URL("/assets/YiYi%E5%B0%8Ficon-B0DJUFEA.png",import.meta.url).href,value:"yiyi"},{type:"image",src:new URL("/assets/Yi-Ting%E5%B0%8Ficon-DsN1lu1f.png",import.meta.url).href,value:"yiting"},{type:"image",src:new URL("/assets/Yi-ling%E5%B0%8Ficon-CHIbv5yx.png",import.meta.url).href,value:"yiling"},{type:"image",src:new URL("/assets/%E7%A7%8B%E6%85%A7%E5%B0%8Ficon-BvW9YUXy.png",import.meta.url).href,value:"qiuhui"},{type:"image",src:new URL("/assets/%E5%A5%95%E5%90%9B%E5%B0%8Ficon-x_qW8Xf5.png",import.meta.url).href,value:"yijun"},{type:"image",src:new URL("/assets/%E9%9F%B3%E7%A7%80%E5%B0%8Ficon-DvUn-iI9.png",import.meta.url).href,value:"yinxiu"},{type:"image",src:new URL("/assets/%E5%85%89%E8%8F%AF%E5%B0%8Ficon-QpHtXqbC.png",import.meta.url).href,value:"guanghua"},{type:"image",src:new URL("/assets/%E9%9B%85%E5%8D%BF%E5%B0%8Ficon-5jTT8wvb.png",import.meta.url).href,value:"yaching"},{type:"image",src:new URL("/assets/%E5%A6%8D%E4%BC%B6%E5%B0%8Ficon-D_h7Q-cy.png",import.meta.url).href,value:"yanling"},{type:"image",src:new URL("/assets/%E6%98%A5%E8%8A%B3%E5%B0%8Ficon-DtY9SgG9.png",import.meta.url).href,value:"chunfang"},{type:"image",src:new URL("/assets/%E9%83%81%E7%8E%B2%E5%B0%8Ficon-D9XvrXAQ.png",import.meta.url).href,value:"southyuling"},{type:"image",src:new URL("/assets/%E5%9F%B9%E8%8A%AC%E5%B0%8Ficon-FRRXledi.png",import.meta.url).href,value:"peifen"},{type:"image",src:new URL("/assets/%E6%AF%93%E6%83%A0%E5%B0%8Ficon-rf1I1nRn.png",import.meta.url).href,value:"yuhui"},{type:"image",src:new URL("/assets/%E7%91%9E%E5%A3%AB%E5%B0%8Ficon-DIBsD0gd.png",import.meta.url).href,value:"ruishi"},{type:"image",src:new URL("/assets/%E6%85%B6%E7%91%9C%E5%B0%8Ficon-C57TWKAT.png",import.meta.url).href,value:"qingyu"},{type:"image",src:new URL("/assets/%E9%B4%BB%E7%A5%A5%E5%B0%8Ficon-C2kMTpa5.png",import.meta.url).href,value:"hongxiang"},{type:"image",src:new URL("/assets/Jenny%E5%B0%8Ficon-B4eelzrN.png",import.meta.url).href,value:"jenny"},{type:"image",src:new URL("/assets/Tim%E5%B0%8Ficon-BvJSbH-W.png",import.meta.url).href,value:"tim"},{type:"image",src:new URL("/assets/yu%20lin%E5%B0%8Ficon-BCQPoLSa.png",import.meta.url).href,value:"yulin"}],O=["😊","🚀","🌟","☀️","💧","🌳","🐟","🦈","🪷","🐬"],J=m([...X,...O.map(t=>({type:"emoji",value:t}))]),R=m(!1),D=m(""),T=m(""),p=m(null),_=m(""),v=m([]),l=m(null);let s=null,y=null;const L=m([]),f=m([]),S=m(0),W=G(()=>{if(!R.value||!Array.isArray(v.value))return!1;const t=new Date().toDateString();return v.value.some(e=>e.username===T.value&&e.dateString===t)}),N=G(()=>[...v.value].sort((t,e)=>(e.timestamp||0)-(t.timestamp||0)));function Q(){const t={timeZone:"Asia/Taipei",year:"numeric",month:"long",day:"numeric",weekday:"long"};return new Date().toLocaleDateString("zh-TW",t)}const Z=m(Q()),K={id:"default-greeting",username:"池塘管理員",avatar:"🌊",message:"來打招呼吧！",timestamp:Date.now(),dateString:new Date().toDateString()},ee=G(()=>{const t=new Date,e={timeZone:"Asia/Taipei"},a=new Date(t.toLocaleString("en-US",e)).toDateString(),n=v.value.filter(u=>{const g=new Date(u.timestamp);return new Date(g.toLocaleString("en-US",e)).toDateString()===a});return n.length>0?n:[K]});function te(){D.value&&p.value&&(T.value=D.value,R.value=!0,V(()=>{H()}))}function ae(){R.value=!1,T.value="",D.value="",p.value=null,_.value="",y&&(cancelAnimationFrame(y),y=null),f.value=[],L.value=[],S.value=0,window.removeEventListener("resize",k)}function ne(){if(!_.value||!R.value||W.value)return;const t=new Date,e={id:`msg-${t.getTime()}-${Math.random().toString(16).slice(2)}`,username:T.value,avatar:p.value,message:_.value,timestamp:t.getTime(),dateString:t.toDateString()},a=[...v.value,e];Be(Y,a).then(()=>{console.log("留言已寫入 Firebase"),l.value&&C(Math.random()*l.value.width,Math.random()*l.value.height),_.value=""}).catch(n=>{console.error("寫入 Firebase 時發生錯誤:",n)})}function H(){if(!l.value){console.error("Canvas element not found!");return}if(s=l.value.getContext("2d"),!s){console.error("Failed to get 2D context");return}k(),q(),ce(),window.addEventListener("resize",k)}function k(){if(!l.value||!s)return;const t=l.value.parentElement;t&&(l.value.width=t.clientWidth,l.value.height=t.clientHeight)}function q(){if(!Array.isArray(v.value))return;const t=ee.value;t.forEach(a=>{if(!a||!a.id)return;const n=f.value.findIndex(u=>u.id===a.id);n===-1?se(a):(f.value[n].message=a.message,f.value[n].avatar=a.avatar,f.value[n].username=a.username)});const e=t.map(a=>a.id).filter(Boolean);f.value=f.value.filter(a=>e.includes(a.id))}function se(t){if(!l.value)return;const e=l.value;let a=null;t.avatar&&t.avatar.type==="image"&&(a=new Image,a.src=t.avatar.src),f.value.push({id:t.id,avatar:t.avatar,username:t.username,message:t.message,x:Math.random()*(e.width-50)+25,y:Math.random()*(e.height-50)+25,vx:(Math.random()-.5)*.8,vy:(Math.random()-.5)*.8,size:30,imageObj:a})}function C(t,e){L.value.push({x:t,y:e,radius:0,maxRadius:40+Math.random()*20,lineWidth:1.5,opacity:.7,speed:.8+Math.random()*.4})}function ie(){if(!s||!l.value)return;const t=l.value;s.clearRect(0,0,t.width,t.height);const e=s.createLinearGradient(0,0,0,t.height);e.addColorStop(0,"#a0d8f0"),e.addColorStop(1,"#79c2e6"),s.fillStyle=e,s.fillRect(0,0,t.width,t.height)}function le(){if(s)for(let t=L.value.length-1;t>=0;t--){const e=L.value[t];s.beginPath(),s.arc(e.x,e.y,e.radius,0,Math.PI*2),s.strokeStyle=`rgba(255, 255, 255, ${e.opacity})`,s.lineWidth=e.lineWidth,s.stroke(),e.radius+=e.speed,e.opacity-=.01,(e.radius>e.maxRadius||e.opacity<=0)&&L.value.splice(t,1)}}function oe(t,e,a,n,u,g,h,me,ve,pe){if(!e)return;t.font=pe,t.textBaseline="top";const j=e.split(" "),U=[];let x=j[0];for(let F=1;F<j.length;F++){const B=j[F];t.measureText(x+" "+B).width<u?x+=" "+B:(U.push(x),x=B)}U.push(x);let z=0;U.forEach(F=>{const B=t.measureText(F).width;B>z&&(z=B)});const b=z+h*2,A=U.length*g+h*2,c=a-b/2,d=n-A-5;t.fillStyle=me;const w=6;t.beginPath(),t.moveTo(c+w,d),t.lineTo(c+b-w,d),t.quadraticCurveTo(c+b,d,c+b,d+w),t.lineTo(c+b,d+A-w),t.quadraticCurveTo(c+b,d+A,c+b-w,d+A),t.lineTo(c+w,d+A),t.quadraticCurveTo(c,d+A,c,d+A-w),t.lineTo(c,d+w),t.quadraticCurveTo(c,d,c+w,d),t.closePath(),t.fill(),t.fillStyle=ve,U.forEach((F,B)=>{t.fillText(F,c+h,d+h+B*g)})}function re(){if(!s||!l.value)return;const t=l.value;f.value.forEach(e=>{var g,h;e.x+=e.vx,e.y+=e.vy;const a=70,n=e.size/2;e.x-n<0?(e.x=n,e.vx*=-1):e.x+n>t.width&&(e.x=t.width-n,e.vx*=-1),e.y-n-a<0?(e.y=n+a,e.vy=Math.abs(e.vy)):e.y+n>t.height&&(e.y=t.height-n,e.vy*=-1);const u=e.message;oe(s,u,e.x,e.y-n,130,16,8,"rgba(255, 255, 255, 0.85)","#333","14px sans-serif"),((g=e.avatar)==null?void 0:g.type)==="emoji"?(s.font=`${e.size}px sans-serif`,s.textAlign="center",s.textBaseline="middle",s.fillText(e.avatar.value,e.x,e.y)):((h=e.avatar)==null?void 0:h.type)==="image"&&e.imageObj?s.drawImage(e.imageObj,e.x-e.size/2,e.y-e.size/2,e.size,e.size):(s.font=`${e.size}px sans-serif`,s.textAlign="center",s.textBaseline="middle",s.fillText("💧",e.x,e.y))})}function ue(){if(l.value&&Math.random()<.015){const t=Math.random()*l.value.width,e=Math.random()*l.value.height;C(t,e)}}function ce(){y&&cancelAnimationFrame(y);const t=()=>{ie(),ue(),le(),re(),y=requestAnimationFrame(t)};t()}ge(()=>{he(Y,t=>{let e=[];if(t.exists()){const a=t.val();Array.isArray(a)?(e=a,e.forEach((n,u)=>{n.id||(n.id=`fallback-${n.timestamp||u}-${Math.random().toString(16).slice(2)}`),typeof n.message>"u"&&(n.message="")})):a&&typeof a=="object"&&(e=Object.entries(a).map(([n,u])=>({id:n,message:u.message||"",...u})))}v.value=e,V(()=>{s?q():H(),v.value.length>S.value&&l.value&&C(Math.random()*l.value.width,Math.random()*l.value.height),S.value=v.value.length})},t=>{console.error("Error fetching data from Firebase:",t),v.value=[],f.value=[]})}),ye(()=>{y&&(cancelAnimationFrame(y),y=null),window.removeEventListener("resize",k)});function de(t){if(!t)return"";const e=new Date(t),n=new Date().getTime()-e.getTime(),u=Math.floor(n/(60*1e3)),g=Math.floor(n/(60*60*1e3)),h=Math.floor(n/(24*60*60*1e3));return u<60?`${u} 分鐘前`:g<24?`${g} 小時前`:`${h} 天前`}return(t,e)=>(r(),o(M,null,[i("div",be,[i("h3",Ae,E(Z.value),1),e[6]||(e[6]=i("h3",{class:"pond-title"},"自主學習促進會今日池塘動態",-1)),i("div",Fe,[i("canvas",{class:"pond-canvas",ref_key:"pondCanvas",ref:l},null,512)]),R.value?(r(),o("div",Me,[i("div",Se,[i("h2",null,[we("Hi, "+E(T.value),1),p.value.type==="emoji"?(r(),o("span",Ce,E(p.value.value),1)):(r(),o("img",{key:1,class:"avatar-img",src:p.value.src,alt:p.value.value},null,8,je))]),i("button",{onClick:ae},"離開池塘")]),W.value?(r(),o("p",Ie,"你今天已經打過招呼了！")):(r(),o("div",ze,[I(i("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),placeholder:"今天想說些什麼？"},null,512),[[$,_.value,void 0,{trim:!0}]]),i("button",{onClick:ne,disabled:!_.value},"向大家打招呼！",8,Ge)]))])):(r(),o("div",De,[e[5]||(e[5]=i("h2",null,"加入池塘對話！",-1)),i("div",Re,[e[3]||(e[3]=i("label",{for:"username"},"你的名字：",-1)),I(i("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=a=>D.value=a),placeholder:"輸入你的暱稱"},null,512),[[$,D.value,void 0,{trim:!0}]]),e[4]||(e[4]=i("label",null,"頭像選擇：",-1)),i("div",Te,[(r(!0),o(M,null,P(J.value,(a,n)=>(r(),o("label",{key:n},[I(i("input",{type:"radio",name:"avatar",value:a,"onUpdate:modelValue":e[1]||(e[1]=u=>p.value=u)},null,8,Le),[[_e,p.value]]),a.type==="emoji"?(r(),o("span",Ue,E(a.value),1)):(r(),o("img",{key:1,class:"avatar-img",src:a.src,alt:a.value},null,8,xe))]))),128))]),i("button",{onClick:te,disabled:!D.value||!p.value},"進入池塘",8,ke)])]))]),e[8]||(e[8]=i("h3",{class:"messages-title"},"池塘訊息列表",-1)),i("div",We,[v.value.length===0?(r(),o("div",He,e[7]||(e[7]=[i("p",{class:"empty-message"},"今天池塘很安靜... 快來打聲招呼吧！",-1)]))):Ee("",!0),(r(!0),o(M,null,P(N.value,a=>(r(),o("div",{class:"message-item",key:a.id},[i("div",qe,[a.avatar&&typeof a.avatar=="object"?(r(),o(M,{key:0},[a.avatar.type==="emoji"?(r(),o("span",$e,E(a.avatar.value),1)):(r(),o("img",{key:1,class:"avatar-img",src:a.avatar.src,alt:a.avatar.value},null,8,Pe))],64)):(r(),o("span",Ve,E(a.avatar||"💧"),1)),i("span",Ye,E(a.username),1),i("span",Xe,E(de(a.timestamp)),1)]),i("div",Oe,E(a.message),1)]))),128))])],64))}},Ke=fe(Je,[["__scopeId","data-v-996ceb12"]]);export{Ke as default};
