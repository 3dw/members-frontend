import{g as L,h as a,i as b,E as h,a as i,b as s,k as p,q as v,F as g,j as w,n as k,o as r,t as m,d as u,f as c,C as q,_ as C}from"./index-Bz2aCfqi.js";const H=L({name:"FaqView",props:{uid:{type:String,required:!0}},setup(){const e=a([]),t=a(["全部","起步","計畫","支持","資源","其他"]),l=a(""),d=a("全部"),f=a(""),y=a(""),n=a("");return b(async()=>{try{const o=await h.get("https://members-backend.alearn13994229.workers.dev/api/Faq");e.value=o.data}catch(o){console.error("獲取FAQ資料失敗:",o)}}),{faqItems:e,categories:t,searchKeyword:l,selectedCategory:d,newLinkText:f,newLinkHref:y,showAddLinkId:n}},computed:{sortedFaqItems(){return this.faqItems.slice().sort((e,t)=>this.categories.indexOf(e.category)-this.categories.indexOf(t.category))},filteredAndSortedFaqItems(){const e=this.searchKeyword.toLowerCase().trim();let t=this.faqItems;return this.selectedCategory!=="全部"&&(t=t.filter(l=>l.category===this.selectedCategory)),e&&(t=t.filter(l=>l.category.toLowerCase().includes(e)||l.question.toLowerCase().includes(e)||l.answer.toLowerCase().includes(e))),t.sort((l,d)=>this.categories.indexOf(l.category)-this.categories.indexOf(d.category))}},methods:{toggleLogin(){this.$emit("toggleLogin")},fetchFaq(){this.faqItems=[],h.get("https://members-backend.alearn13994229.workers.dev/api/Faq").then(e=>{this.faqItems=e.data}).catch(e=>{console.error("獲取FAQ資料失敗:",e)})},parseLinks(e){return console.log(e),JSON.parse(e).filter(t=>t!=null&&t.t!=="")},parseAnswer(e){return console.log(e),e.replace(/\\n/g,`
`)},editFaq(e){console.log(e),this.$router.push(`/edit_faq/${e}`)},deleteFaq(e){console.log(e)},deleteLink(e,t){console.log(e,t),confirm("確定要刪除此連結嗎？")&&(console.log("刪除"),h.delete(`https://members-backend.alearn13994229.workers.dev/delete/faq/${e}/link/${t}`).then(()=>{window.alert("刪除成功"),console.log("刪除成功"),this.fetchFaq()}).catch(l=>{window.alert("刪除失敗"),console.error("刪除失敗:",l)}))},addLink(e){console.log(e);const t={t:this.newLinkText,h:this.newLinkHref};console.log(t),h.post(`https://members-backend.alearn13994229.workers.dev/insert/faq/${e}/link`,t).then(()=>{window.alert("新增成功"),this.newLinkText="",this.newLinkHref="",this.showAddLinkId="",console.log("新增成功"),this.fetchFaq()}).catch(l=>{window.alert("新增失敗"),console.error("新增失敗:",l)})},escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},highlightText(e){if(!this.searchKeyword.trim())return this.escapeHtml(e);const t=this.escapeHtml(e),l=this.escapeHtml(this.searchKeyword.toLowerCase().trim()),d=new RegExp(`(${l})`,"gi");return t.replace(d,'<span class="highlight">$1</span>')}}}),T={class:"faq-container"},F={class:"ui container"},$={class:"ui form"},I={class:"two stackable fields"},A={class:"field",style:{"max-width":"150px"}},M=["value"],V={class:"field"},K={class:"ui icon input"},S={class:"ui celled table"},O=["innerHTML"],N=["innerHTML"],U=["innerHTML"],B={class:"answer-cell"},E={key:0,class:"ui bulleted list"},D=["href"],Q=["onClick"],j={class:"item"},J=["onClick"],R={key:1,class:"item"},z={class:"ui form"},G={class:"ui buttons"},P=["href"],W=["src"],X=["onClick"],Y=["onClick"];function Z(e,t,l,d,f,y){return r(),i("div",T,[t[18]||(t[18]=s("h2",{class:"ui header"},"常見問題",-1)),s("div",F,[s("form",$,[s("div",I,[s("div",A,[t[5]||(t[5]=s("label",null,"類別篩選",-1)),p(s("select",{class:"ui dropdown","onUpdate:modelValue":t[0]||(t[0]=n=>e.selectedCategory=n)},[(r(!0),i(g,null,w(e.categories,n=>(r(),i("option",{value:n},m(n),9,M))),256))],512),[[v,e.selectedCategory]])]),s("div",V,[t[7]||(t[7]=s("label",null,"關鍵字篩選",-1)),s("div",K,[p(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>e.searchKeyword=n),placeholder:"搜尋常見問題..."},null,512),[[k,e.searchKeyword]]),t[6]||(t[6]=s("i",{class:"search icon"},null,-1))])])])]),s("table",S,[t[17]||(t[17]=s("thead",null,[s("tr",null,[s("th",null,"類別"),s("th",null,"問題"),s("th",null,"回答"),s("th",null,"相關連結"),s("th",null,"操作")])],-1)),s("tbody",null,[(r(!0),i(g,null,w(e.filteredAndSortedFaqItems,n=>(r(),i("tr",{key:n.id},[s("td",{innerHTML:e.highlightText(n.category)},null,8,O),s("td",{innerHTML:e.highlightText(n.question)},null,8,N),s("td",{class:"answer-cell",innerHTML:e.highlightText(e.parseAnswer(n.answer))},null,8,U),s("td",B,[n.links&&e.parseLinks(n.links).length>0?(r(),i("div",E,[(r(!0),i(g,null,w(e.parseLinks(n.links),o=>(r(),i("div",{class:"item",key:o.h},[s("a",{href:o.h,target:"_blank",rel:"noopener noreferrer"},m(o.t),9,D),t[9]||(t[9]=s("br",null,null,-1)),e.uid?(r(),i("button",{key:0,class:"ui button mini circular red icon",type:"button",onClick:x=>e.deleteLink(n.id,o.h)},t[8]||(t[8]=[s("i",{class:"trash icon"},null,-1),u("刪除")]),8,Q)):c("",!0)]))),128))])):c("",!0),t[14]||(t[14]=s("div",{class:"item ui divider"},null,-1)),s("div",j,[e.uid?(r(),i("button",{key:0,class:"ui button mini circular orange icon",type:"button",onClick:o=>e.showAddLinkId=n.id},t[10]||(t[10]=[s("i",{class:"plus icon"},null,-1),u("新增")]),8,J)):c("",!0)]),e.showAddLinkId===n.id?(r(),i("div",R,[s("div",z,[p(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>e.newLinkText=o),placeholder:"連結名稱"},null,512),[[k,e.newLinkText]]),p(s("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>e.newLinkHref=o),placeholder:"連結網址"},null,512),[[k,e.newLinkHref]]),t[13]||(t[13]=s("br",null,null,-1)),s("div",G,[e.newLinkHref?(r(),i("a",{key:0,class:"ui basic primary button",href:e.newLinkHref,target:"_blank",rel:"noopener noreferrer"},[s("img",{src:"https://www.google.com/s2/favicons?domain="+e.newLinkHref,alt:"測試連結"},null,8,W),t[11]||(t[11]=u("測試連結"))],8,P)):c("",!0),s("button",{class:"ui button primary",type:"button",onClick:q(o=>e.addLink(n.id),["prevent"])},t[12]||(t[12]=[s("i",{class:"plus icon"},null,-1),u("新增")]),8,X)])])])):c("",!0)]),s("td",null,[e.uid?(r(),i("button",{key:1,class:"ui button primary",type:"button",onClick:o=>e.editFaq(n.id)},t[16]||(t[16]=[s("i",{class:"pencil icon"},null,-1),u("編輯")]),8,Y)):(r(),i("button",{key:0,class:"ui button orange",type:"button",onClick:t[4]||(t[4]=(...o)=>e.toggleLogin&&e.toggleLogin(...o))},t[15]||(t[15]=[s("i",{class:"user icon"},null,-1),u("登人")])))])]))),128))])])])])}const ee=C(H,[["render",Z],["__scopeId","data-v-74e6cbcc"]]);export{ee as default};
