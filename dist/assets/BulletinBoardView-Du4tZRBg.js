import{d as S,r as m,c as U,o as V,a as I,n as N,s as R,b as O,e as A,f as D,g as u,h as o,i as h,F as C,j as _,w as q,v as F,k as c,t as v,l as z,_ as E}from"./index-DioPGc-t.js";const H=S({props:{uid:{required:!1,default:""},users:{required:!1,default:()=>({})}},setup(e,{emit:i}){const d=m([{author:"AliceS",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"BobS",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."}].map(t=>({...t,reactions:{}}))),g=m(""),k=m(!1),w=U(()=>[...d.value].sort((t,s)=>{const a=new Date(t.date);return new Date(s.date).getTime()-a.getTime()})),n=()=>{if(!k.value)return;console.log(g.value);const t=d.value.length,s={author:e.users[e.uid].name||"匿名",uid:e.uid||"123",date:new Date().toISOString(),text:g.value,reactions:{}};d.value.push(s),g.value="",R(O(A,"messages/"+t),s).then(()=>{console.log("留言成功")})},b=()=>{i("toggleLogin")},r=t=>{const s=new Date,a=new Date(t);if(isNaN(a.getTime()))return"無效日期";const l=s.getTime()-a.getTime(),f=Math.floor(l/1e3),M=Math.floor(l/(1e3*60)),p=Math.floor(l/(1e3*60*60)),T=Math.floor(l/(1e3*60*60*24));return f<60?f===0?"剛剛":`${f} 秒前`:M<60?`${M} 分鐘前`:p<24?`${p} 小時前`:`${T} 天前`},y=(t,s)=>{e.uid&&(t.reactions||(t.reactions={}),t.reactions[s]||(t.reactions[s]={}),t.reactions[s][e.uid]?delete t.reactions[s][e.uid]:t.reactions[s][e.uid]=!0,R(D,d.value).then(()=>{console.log("反應更新成功")}))},$=(t,s)=>{var a,l;return((l=(a=t.reactions)==null?void 0:a[s])==null?void 0:l[e.uid])||!1},B=(t,s)=>{var a;return Object.keys(((a=t.reactions)==null?void 0:a[s])||{}).length},L=(t,s)=>{var a;return(a=t.reactions)!=null&&a[s]?Object.keys(t.reactions[s]).map(l=>{var f;return((f=e.users[l])==null?void 0:f.name)||"匿名用戶"}).join("、"):""};return V(()=>{console.log("mounted"),I(D,t=>{const s=t.val();console.log(s),d.value=s.map(a=>({author:a.author,uid:a.uid,date:a.date,text:a.text,reactions:a.reactions||{}})),k.value=!0}),setInterval(async()=>{console.log("tick"),await N(),d.value=[...d.value]},60*1e3)}),{messages:d,newMessage:g,addMessage:n,parseDate:r,toggleLogin:b,sortedMessages:w,toggleReaction:y,hasReacted:$,getReactionCount:B,getReactionUsers:L,dataLoaded:k}}}),j={class:"ui container two column stackable grid"},G={key:0,class:"column"},J={class:"ui segment"},K={key:1,class:"ui comments flex-column column"},P={class:"content"},Q=["src"],W={class:"author"},X={class:"metadata"},Y={class:"date"},Z={class:"text"},x={class:"actions"},ee={class:"reaction-buttons"},te=["onClick"],se={key:0,class:"reaction-tooltip"},oe={class:"emoji"},ne={class:"count"},ae={key:2,class:"ui form reply column"},ie={class:"field"};function le(e,i,d,g,k,w){return c(),u("div",j,[e.uid?h("",!0):(c(),u("div",G,[o("div",J,[i[3]||(i[3]=o("div",{class:"ui header"},"留言板",-1)),i[4]||(i[4]=o("div",{class:"ui description"},"請先登入才能留言",-1)),i[5]||(i[5]=o("div",{class:"ui divider"},null,-1)),o("button",{class:"ui large green basic button",onClick:i[0]||(i[0]=(...n)=>e.toggleLogin&&e.toggleLogin(...n))},"登入")])])),e.uid?(c(),u("div",K,[(c(!0),u(C,null,_(e.sortedMessages,(n,b)=>(c(),u("div",{class:"comment",key:b},[o("div",P,[e.users&&e.users[n.uid]&&e.users[n.uid].photoURL?(c(),u("img",{key:0,class:"ui avatar image",src:e.users[n.uid].photoURL},null,8,Q)):h("",!0),o("div",W,v(n.author),1),o("div",X,[o("div",Y,v(e.parseDate(n.date)),1)]),o("div",Z,v(n.text),1),o("div",x,[o("div",ee,[(c(),u(C,null,_(["👍","❤️","🙏","🫡","❤️‍🔥","😢"],r=>o("button",{class:z(["reaction-btn",{active:e.hasReacted(n,r)}]),key:r,onClick:y=>e.toggleReaction(n,r)},[e.getReactionCount(n,r)>0?(c(),u("div",se,v(e.getReactionUsers(n,r)),1)):h("",!0),o("span",oe,v(r),1),o("span",ne,v(e.getReactionCount(n,r)),1)],10,te)),64))])])])]))),128))])):h("",!0),e.uid?(c(),u("div",ae,[i[7]||(i[7]=o("div",{class:"ui divider thin-only"},null,-1)),o("div",ie,[i[6]||(i[6]=o("label",null,"輸入留言",-1)),q(o("textarea",{"onUpdate:modelValue":i[1]||(i[1]=n=>e.newMessage=n)},null,512),[[F,e.newMessage]])]),o("div",{class:"ui primary submit button",onClick:i[2]||(i[2]=(...n)=>e.addMessage&&e.addMessage(...n))},"留言")])):h("",!0)])}const re=E(H,[["render",le],["__scopeId","data-v-3e3b8f27"]]);export{re as default};
