import{d as S,r as b,c as U,o as V,a as I,n as N,s as D,b as p,e as r,f as s,g as h,F as C,h as _,w as A,v as O,i as c,t as v,j as q,_ as F}from"./index-CxCwd2jm.js";const z=S({props:{uid:{required:!1,default:""},users:{required:!1,default:()=>({})}},setup(t,{emit:a}){const u=b([{author:"AliceS",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"BobS",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."}].map(e=>({...e,reactions:{}}))),g=b(""),k=b(!1),w=U(()=>[...u.value].sort((e,n)=>{const i=new Date(e.date);return new Date(n.date).getTime()-i.getTime()})),o=()=>{k.value&&(console.log(g.value),u.value.push({author:t.users[t.uid].name||"匿名",uid:t.uid||"123",date:new Date().toISOString(),text:g.value,reactions:{}}),g.value="",D(p,u.value).then(()=>{console.log("留言成功")}))},y=()=>{a("toggleLogin")},d=e=>{const n=new Date,i=new Date(e);if(isNaN(i.getTime()))return"無效日期";const l=n.getTime()-i.getTime(),f=Math.floor(l/1e3),m=Math.floor(l/(1e3*60)),R=Math.floor(l/(1e3*60*60)),T=Math.floor(l/(1e3*60*60*24));return f<60?f===0?"剛剛":`${f} 秒前`:m<60?`${m} 分鐘前`:R<24?`${R} 小時前`:`${T} 天前`},M=(e,n)=>{t.uid&&(e.reactions||(e.reactions={}),e.reactions[n]||(e.reactions[n]={}),e.reactions[n][t.uid]?delete e.reactions[n][t.uid]:e.reactions[n][t.uid]=!0,D(p,u.value).then(()=>{console.log("反應更新成功")}))},$=(e,n)=>{var i,l;return((l=(i=e.reactions)==null?void 0:i[n])==null?void 0:l[t.uid])||!1},B=(e,n)=>{var i;return Object.keys(((i=e.reactions)==null?void 0:i[n])||{}).length},L=(e,n)=>{var i;return(i=e.reactions)!=null&&i[n]?Object.keys(e.reactions[n]).map(l=>{var f;return((f=t.users[l])==null?void 0:f.name)||"匿名用戶"}).join("、"):""};return V(()=>{console.log("mounted"),I(p,e=>{const n=e.val();console.log(n),u.value=n.map(i=>({author:i.author,uid:i.uid,date:i.date,text:i.text,reactions:i.reactions||{}})),k.value=!0}),setInterval(async()=>{console.log("tick"),await N(),u.value=[...u.value]},60*1e3)}),{messages:u,newMessage:g,addMessage:o,parseDate:d,toggleLogin:y,sortedMessages:w,toggleReaction:M,hasReacted:$,getReactionCount:B,getReactionUsers:L,dataLoaded:k}}}),E={class:"ui container two column stackable grid"},H={key:0,class:"column"},G={class:"ui segment"},J={key:1,class:"ui comments flex-column column"},K={class:"content"},P=["src"],Q={class:"author"},W={class:"metadata"},X={class:"date"},Y={class:"text"},Z={class:"actions"},j={class:"reaction-buttons"},x=["onClick"],tt={key:0,class:"reaction-tooltip"},et={class:"emoji"},st={class:"count"},ot={key:2,class:"ui form reply column"},nt={class:"field"};function it(t,a,u,g,k,w){return c(),r("div",E,[t.uid?h("",!0):(c(),r("div",H,[s("div",G,[a[3]||(a[3]=s("div",{class:"ui header"},"留言板",-1)),a[4]||(a[4]=s("div",{class:"ui description"},"請先登入才能留言",-1)),a[5]||(a[5]=s("div",{class:"ui divider"},null,-1)),s("button",{class:"ui large green basic button",onClick:a[0]||(a[0]=(...o)=>t.toggleLogin&&t.toggleLogin(...o))},"登入")])])),t.uid?(c(),r("div",J,[(c(!0),r(C,null,_(t.sortedMessages,(o,y)=>(c(),r("div",{class:"comment",key:y},[s("div",K,[t.users&&t.users[o.uid]&&t.users[o.uid].photoURL?(c(),r("img",{key:0,class:"ui avatar image",src:t.users[o.uid].photoURL},null,8,P)):h("",!0),s("div",Q,v(o.author),1),s("div",W,[s("div",X,v(t.parseDate(o.date)),1)]),s("div",Y,v(o.text),1),s("div",Z,[s("div",j,[(c(),r(C,null,_(["👍","❤️","🙏","🫡","❤️‍🔥","😢"],d=>s("button",{class:q(["reaction-btn",{active:t.hasReacted(o,d)}]),key:d,onClick:M=>t.toggleReaction(o,d)},[t.getReactionCount(o,d)>0?(c(),r("div",tt,v(t.getReactionUsers(o,d)),1)):h("",!0),s("span",et,v(d),1),s("span",st,v(t.getReactionCount(o,d)),1)],10,x)),64))])])])]))),128))])):h("",!0),t.uid?(c(),r("div",ot,[a[7]||(a[7]=s("div",{class:"ui divider thin-only"},null,-1)),s("div",nt,[a[6]||(a[6]=s("label",null,"輸入留言",-1)),A(s("textarea",{"onUpdate:modelValue":a[1]||(a[1]=o=>t.newMessage=o)},null,512),[[O,t.newMessage]])]),s("div",{class:"ui primary submit button",onClick:a[2]||(a[2]=(...o)=>t.addMessage&&t.addMessage(...o))},"留言")])):h("",!0)])}const lt=F(z,[["render",it],["__scopeId","data-v-02593e08"]]);export{lt as default};
