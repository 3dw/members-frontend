import{g as h,d as p,o as A}from"./index.esm2017-DOlBnH-4.js";import{a as B,_ as E,c as o,b as u,d as i,F as y,r as b,w as C,v as D,e as v,f as m,o as s,n as k,t as g,g as _,h as f}from"./index-B-UgqAhp.js";const R={data(){return{selectedAmount:"500",customAmount:500,mode:"donate-by-card",modes:["donate-by-card","donate-by-qrcode","donate-by-bank-transfer","donate-by-code"],unsubscribe:()=>{},merchantID:"3002607",returnURL:"https://members-backend.alearn13994229.workers.dev/donation_callback",checkMacValue:"",clientBackURL:window.location.origin+"/donate",orderResultURL:""}},async mounted(){this.orderResultURL=window.location.origin+"/donate_complete/"+this.merchantTradeNo,this.checkMacValue=await this.generateCheckMacValue()},computed:{donationAmount(){return this.selectedAmount==="custom"?this.customAmount:parseInt(this.selectedAmount)},merchantTradeNo(){return`DON${Date.now()}${Math.floor(Math.random()*1e3)}`},merchantTradeDate(){return new Date().toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+)/,"$1/$2/$3")}},watch:{async donationAmount(){this.checkMacValue=await this.generateCheckMacValue()}},methods:{parse(n){if(n==="donate-by-card")return"信用卡小額捐贈";if(n==="donate-by-bank-transfer")return"銀行匯款捐贈";if(n==="donate-by-qrcode")return"QR Code掃碼捐贈";if(n==="donate-by-code")return"愛心碼捐贈"},clearCustomAmount(){this.selectedAmount!=="custom"&&(this.customAmount=500)},listenToOrderStatus(n){const e=h(B),d=p(e,"donations",n);this.unsubscribe=A(d,l=>{var r,a,c,F;const t=l.data();if(t)switch(t.status){case"completed":alert("捐贈成功，謝謝您的捐贈"),(r=this.unsubscribe)==null||r.call(this);break;case"simulated":alert("此為模擬捐贈，並未實際捐贈"),(a=this.unsubscribe)==null||a.call(this);break;case"pending":console.log("捐贈處理中，請稍後再查詢"),(c=this.unsubscribe)==null||c.call(this);break;case"failed":alert("捐贈失敗，請改為其他方式捐贈"),(F=this.unsubscribe)==null||F.call(this);break}}),setTimeout(()=>{var l;(l=this.unsubscribe)==null||l.call(this)},5*60*1e3)},async generateCheckMacValue(){const n={MerchantID:this.merchantID,MerchantTradeNo:this.merchantTradeNo,MerchantTradeDate:this.merchantTradeDate,PaymentType:"aio",TotalAmount:this.donationAmount,TradeDesc:"自主學習促進會捐款",ItemName:"捐款",ReturnURL:this.returnURL,ChoosePayment:"Credit",EncryptType:"1",ClientBackURL:this.clientBackURL,OrderResultURL:this.orderResultURL},e=Object.keys(n).sort(),d="pwFHCqoQZGmho4w6",l="EkRm7iFT261dpevs";let t="HashKey="+d;e.forEach(c=>{t+="&"+c+"="+n[c]}),t+="&HashIV="+l;let r=encodeURIComponent(t).toLowerCase();return r=r.replace(/%20/g,"+").replace(/%2d/g,"-").replace(/%5f/g,"_").replace(/%2e/g,".").replace(/%21/g,"!").replace(/%2a/g,"*").replace(/%28/g,"(").replace(/%29/g,")"),(await this.sha256(r)).toUpperCase()},sha256(n){const e=new TextEncoder().encode(n);return crypto.subtle.digest("SHA-256",e).then(d=>Array.from(new Uint8Array(d)).map(l=>l.toString(16).padStart(2,"0")).join(""))}},beforeUnmount(){var n;(n=this.unsubscribe)==null||n.call(this)}},T={class:"ui segment container"},w={class:"ui header"},U={key:0},L={key:1},M={key:2},V={key:3},I={class:"ui vertical buttons"},N=["onClick"],S={key:0,method:"post",action:"https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5",target:"_blank"},x={class:"ui form"},q={class:"ui two stackable fields"},H={class:"compact field"},O={key:0,class:"field"},P=["value"],Q=["value"],K=["value"],j=["value"],z=["value"],G=["value"],W=["value"],Z=["value"],J={key:1,class:"ui divider"},X={key:2,class:"ui segment"},Y={key:3,class:"ui segment"},$={key:4,class:"ui segment"},uu={key:5,class:"ui divider"},eu={key:6,class:"ui segment"};function tu(n,e,d,l,t,r){return s(),o("div",T,[u("h2",w,[e[3]||(e[3]=u("span",null,[u("i",{class:"dollar icon"})],-1)),t.mode==="donate-by-card"?(s(),o("span",U,"信用卡小額捐贈")):t.mode==="donate-by-qrcode"?(s(),o("span",L,"QR Code掃碼捐贈")):t.mode==="donate-by-bank-transfer"?(s(),o("span",M,"銀行匯款捐贈")):t.mode==="donate-by-code"?(s(),o("span",V,"愛心碼捐贈")):i("",!0),e[4]||(e[4]=u("span",null,"   ",-1)),u("div",I,[(s(!0),o(y,null,b(t.modes,a=>(s(),o("button",{class:k(["ui basic green large button",{active:t.mode===a}]),key:a,onClick:c=>t.mode=a},g(r.parse(a)),11,N))),128))])]),t.mode==="donate-by-card"?(s(),o("form",S,[u("div",x,[u("div",q,[u("div",H,[e[6]||(e[6]=u("label",null,"選擇捐贈金額",-1)),C(u("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.selectedAmount=a),onChange:e[1]||(e[1]=(...a)=>r.clearCustomAmount&&r.clearCustomAmount(...a))},e[5]||(e[5]=[u("option",{value:"500"},"新台幣500元",-1),u("option",{value:"1000"},"新台幣1000元",-1),u("option",{value:"2000"},"新台幣2000元",-1),u("option",{value:"custom"},"自訂金額",-1)]),544),[[D,t.selectedAmount]])]),t.selectedAmount==="custom"?(s(),o("div",O,[e[7]||(e[7]=u("label",null,"自訂金額：新台幣",-1)),C(u("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=a=>t.customAmount=a),min:"500",placeholder:"輸入金額"},null,512),[[v,t.customAmount,void 0,{number:!0}]])])):i("",!0)]),u("input",{type:"hidden",name:"MerchantID",value:t.merchantID},null,8,P),u("input",{type:"hidden",name:"MerchantTradeNo",value:r.merchantTradeNo},null,8,Q),u("input",{type:"hidden",name:"MerchantTradeDate",value:r.merchantTradeDate},null,8,K),e[8]||(e[8]=u("input",{type:"hidden",name:"PaymentType",value:"aio"},null,-1)),u("input",{type:"hidden",name:"TotalAmount",value:r.donationAmount},null,8,j),e[9]||(e[9]=u("input",{type:"hidden",name:"TradeDesc",value:"自主學習促進會捐款"},null,-1)),e[10]||(e[10]=u("input",{type:"hidden",name:"ItemName",value:"捐款"},null,-1)),u("input",{type:"hidden",name:"ReturnURL",value:t.returnURL},null,8,z),e[11]||(e[11]=u("input",{type:"hidden",name:"ChoosePayment",value:"Credit"},null,-1)),e[12]||(e[12]=u("input",{type:"hidden",name:"EncryptType",value:"1"},null,-1)),u("input",{type:"hidden",name:"CheckMacValue",value:t.checkMacValue},null,8,G),u("input",{type:"hidden",name:"ClientBackURL",value:t.clientBackURL},null,8,W),u("input",{type:"hidden",name:"OrderResultURL",value:t.orderResultURL},null,8,Z),e[13]||(e[13]=u("button",{type:"submit",class:"ui basic green large button"},[u("i",{class:"dollar icon"}),m(" 捐贈 ")],-1))])])):i("",!0),t.mode==="donate-by-bank-transfer"?(s(),o("div",J)):i("",!0),t.mode==="donate-by-bank-transfer"?(s(),o("div",X,e[14]||(e[14]=[u("h3",null,[m("本會銀行帳戶： "),u("br"),m(" 台北富邦 士林分行（012） "),u("br"),m(" 帳號：30012-0000601 "),u("br"),m(" 戶名：社團法人中華民國自主學習促進會 ")],-1)]))):i("",!0),t.mode==="donate-by-qrcode"?(s(),o("div",Y,e[15]||(e[15]=[u("img",{id:"#donate-qrcode",src:_,alt:"線上捐款"},null,-1),u("p",null,"請掃描上方 QR Code",-1)]))):i("",!0),t.mode==="donate-by-code"?(s(),o("div",$,e[16]||(e[16]=[u("h3",null,"以愛心碼「9806」捐助本會",-1),u("p",null,"本會是一個非營利組織，需要您的支持。",-1),u("p",null,"愛心碼取為「9806」，是因為最初成立的契機，在於1998~2006年的「台北市自主學習（中學六年一貫）實驗計畫」，本會第一代會員多是計畫中的親師生及關注計畫的學者賢達，別具意義。",-1),u("p",null,"邀請並歡迎大家未來在開立電子發票的商家購物時，可主動向店員要求使用愛心碼，說出捐贈碼9806，或出示條碼即可。發票若中獎，將會自動捐入本會！",-1),u("img",{id:"donate",src:f,alt:"愛心碼"},null,-1)]))):i("",!0),t.mode!=="donate-by-code"?(s(),o("div",uu)):i("",!0),t.mode!=="donate-by-code"?(s(),o("div",eu,e[17]||(e[17]=[u("h3",null,[m("完成捐款後，請將以下資訊寄至本會行政室： "),u("a",{href:"mailto:alearn13994229@gmail.com"},"Email：alearn13994229@gmail.com")],-1),u("ul",null,[u("li",null,"捐款人姓名"),u("li",null,"聯絡電話"),u("li",null,"通訊地址"),u("li",null,"捐款金額"),u("li",null,"匯款帳號後五碼"),u("li",null,"指定支持的專案（可略）")],-1),u("p",null,"本會將開立捐款收據並寄回給您，可供節稅使用。",-1)]))):i("",!0)])}const su=E(R,[["render",tu],["__scopeId","data-v-61038dc2"]]);export{su as default};
