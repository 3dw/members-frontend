import{m as D,l as v}from"./mix-C9RN6XoF.js";import{o as s,a as l,f as F,j as M,b as o,e as d,t as h,g as n,k as y,n as U,r as T,_ as R,d as A,l as a,v as b,m as N,p as m,F as C,q as V,s as H,x as q,y as w,z as L,A as c,B as S,C as E}from"./index-B_ipqcop.js";const I={class:"hello"},B={class:"image"},G={class:"ui header"},j=["src"],z={key:0},P=["innerHTML"],W={key:1},O={key:2},Z={key:3},J={class:"content"},K={class:"description gray"},Q=["innerHTML"],X=["innerHTML"],Y=["innerHTML"],_=["innerHTML"],$=["innerHTML"],x={key:0,class:"content"},ee={key:0,class:"description"},te={key:1,class:"description"},oe={key:2,class:"description"},ie={class:"content"},se={key:0},le=["src"],ne={key:1},re=["src"],de={class:"content"},ue={key:0,class:"description"},ae=["innerHTML"],he={key:1,class:"description"},pe=["innerHTML"],me=["to"],ge={class:"image"},fe={class:"ui header"},ve=["src"],ye={key:0},ke=["innerHTML"],be={key:1},we={key:2},Le={key:3},Me={class:"content"},Ue={class:"description gray"},Ne=["innerHTML"],Te=["innerHTML"],Ce=["innerHTML"],Ve=["innerHTML"],He=["innerHTML"],Se={key:0,class:"content"},De={key:0,class:"description"},Fe={key:1,class:"description"},Re={key:2,class:"description"},Ae={class:"content"},qe={key:0},ce=["src"],Ee={key:1},Ie=["src"],Be={class:"content"},Ge={key:0,class:"description"},je=["innerHTML"],ze={key:1,class:"description"},Pe=["innerHTML"];function We(t,e,u,g,i,p){const k=T("router-link");return s(),l("div",I,[t.clickable?(s(),F(k,{key:0,to:"/flag/"+(t.h.uid||t.h.idx)},{default:M(()=>[o("div",B,[o("h3",G,[o("img",{class:"main",src:t.getIcon(t.h),alt:"^_^"},null,8,j),d(h(t.h.name),1),t.h.learner_birth?(s(),l("span",z,[e[7]||(e[7]=d("-")),o("span",{innerHTML:t.toAge(t.h.learner_birth)},null,8,P),e[8]||(e[8]=d("歲"))])):n("",!0),t.h.child_birth?(s(),l("span",W,"(孩子約")):n("",!0),t.h.child_birth2?(s(),l("span",O,h(t.toAge(t.h.child_birth2))+" ~",1)):n("",!0),t.h.child_birth?(s(),l("span",Z,h(t.toAge(t.h.child_birth))+" 歲)",1)):n("",!0)])]),o("div",J,[o("p",K,[o("span",{innerHTML:t.highlight(t.h.address,t.mySearch)},null,8,Q),d("   - "+h(t.countDateDiff(t.h.lastUpdate))+"已更新",1)]),t.h.learner_habit?(s(),l("p",{key:0,class:"description",innerHTML:"興趣："+t.highlight(t.h.learner_habit,t.mySearch)},null,8,X)):n("",!0),t.h.share?(s(),l("p",{key:1,class:"description",innerHTML:"可分享："+t.highlight(t.h.share,t.mySearch)},null,8,Y)):n("",!0),t.h.ask?(s(),l("p",{key:2,class:"description",innerHTML:"想學習："+t.highlight(t.h.ask,t.mySearch)},null,8,_)):n("",!0),t.h.price?(s(),l("p",{key:3,class:"description",innerHTML:"可支付："+t.highlight(t.h.price,t.mySearch)},null,8,$)):n("",!0)]),t.h.connect_me&&t.full?(s(),l("div",x,[e[10]||(e[10]=o("div",{class:"ui divider"},null,-1)),t.isEmail(t.h.connect_me)?(s(),l("p",ee,[e[9]||(e[9]=d("點擊寄信：")),o("a",{onClick:e[0]||(e[0]=y(f=>t.gotoMail(t.h.connect_me),["stop"]))},h(t.h.connect_me),1)])):(s(),l("p",te,"聯絡方式： "+h(t.h.connect_me),1)),t.h.freetime?(s(),l("p",oe,"方便時間： "+h(t.h.freetime),1)):n("",!0)])):n("",!0),o("div",ie,[e[15]||(e[15]=o("div",{class:"ui divider"},null,-1)),t.h.site?(s(),l("p",se,[o("a",{onClick:e[1]||(e[1]=y(f=>t.goto(t.h.site),["stop"]))},[e[11]||(e[11]=d("個人網站：")),o("img",{src:"https://www.google.com/s2/favicons?domain="+t.h.site,title:"個人網址",alt:"個人網址"},null,8,le),e[12]||(e[12]=o("i",{class:"right arrow icon"},null,-1))])])):n("",!0),t.h.site2?(s(),l("p",ne,[o("a",{onClick:e[2]||(e[2]=y(f=>t.goto(t.h.site2),["stop"]))},[e[13]||(e[13]=d("社群網站：")),o("img",{src:"https://www.google.com/s2/favicons?domain="+t.h.site2,title:"社群網址",alt:"個人網址"},null,8,re),e[14]||(e[14]=o("i",{class:"right arrow icon"},null,-1))])])):n("",!0)]),o("div",de,[e[18]||(e[18]=o("div",{class:"ui divider"},null,-1)),t.full?(s(),l("p",he,[o("span",{class:"text",innerHTML:t.highlight(t.h.note,t.mySearch)},null,8,pe),e[17]||(e[17]=o("br",null,null,-1))])):(s(),l("p",ue,[o("span",{class:"text",innerHTML:t.highlight(t.part(t.h.note),t.mySearch)+"..."},null,8,ae),e[16]||(e[16]=o("br",null,null,-1))]))])]),_:1},8,["to"])):(s(),l("div",{key:1,to:"/flag/"+(t.h.uid||t.h.idx)},[o("div",ge,[o("h3",fe,[o("img",{class:"main",src:t.getIcon(t.h),alt:"^_^"},null,8,ve),d(h(t.h.name),1),t.h.learner_birth?(s(),l("span",ye,[e[19]||(e[19]=d("-")),o("span",{innerHTML:t.toAge(t.h.learner_birth)},null,8,ke),e[20]||(e[20]=d("歲"))])):n("",!0),t.h.child_birth?(s(),l("span",be,"(孩子約")):n("",!0),t.h.child_birth2?(s(),l("span",we,h(t.toAge(t.h.child_birth2))+" ~",1)):n("",!0),t.h.child_birth?(s(),l("span",Le,h(t.toAge(t.h.child_birth))+" 歲)",1)):n("",!0)])]),o("div",Me,[o("p",Ue,[o("span",{innerHTML:t.highlight(t.h.address,t.mySearch)},null,8,Ne),d("   - "+h(t.countDateDiff(t.h.lastUpdate))+"已更新",1)]),t.h.learner_habit?(s(),l("p",{key:0,class:"description",innerHTML:"興趣："+t.highlight(t.h.learner_habit,t.mySearch)},null,8,Te)):n("",!0),t.h.share?(s(),l("p",{key:1,class:"description",innerHTML:"可分享："+t.highlight(t.h.share,t.mySearch)},null,8,Ce)):n("",!0),t.h.ask?(s(),l("p",{key:2,class:"description",innerHTML:"想學習："+t.highlight(t.h.ask,t.mySearch)},null,8,Ve)):n("",!0),t.h.price?(s(),l("p",{key:3,class:"description",innerHTML:"收費："+t.highlight(t.h.price,t.mySearch)},null,8,He)):n("",!0)]),t.h.connect_me&&t.full?(s(),l("div",Se,[e[22]||(e[22]=o("div",{class:"ui divider"},null,-1)),t.isEmail(t.h.connect_me)?(s(),l("p",De,[e[21]||(e[21]=d("點擊寄信：")),o("a",{onClick:e[3]||(e[3]=y(f=>t.gotoMail(t.h.connect_me),["stop"]))},h(t.h.connect_me),1)])):(s(),l("p",Fe,"聯絡方式： "+h(t.h.connect_me),1)),t.h.freetime?(s(),l("p",Re,"方便時間： "+h(t.h.freetime),1)):n("",!0)])):n("",!0),o("div",Ae,[e[27]||(e[27]=o("div",{class:"ui divider"},null,-1)),t.h.site?(s(),l("p",qe,[o("a",{onClick:e[4]||(e[4]=y(f=>t.goto(t.h.site),["stop"]))},[e[23]||(e[23]=d("個人網站：")),o("img",{src:"https://www.google.com/s2/favicons?domain="+t.h.site,title:"個人網址",alt:"個人網址"},null,8,ce),e[24]||(e[24]=o("i",{class:"right arrow icon"},null,-1))])])):n("",!0),t.h.site2?(s(),l("p",Ee,[o("a",{onClick:e[5]||(e[5]=y(f=>t.goto(t.h.site2),["stop"]))},[e[25]||(e[25]=d("社群網站：")),o("img",{src:"https://www.google.com/s2/favicons?domain="+t.h.site2,title:"社群網址",alt:"個人網址"},null,8,Ie),e[26]||(e[26]=o("i",{class:"right arrow icon"},null,-1))])])):n("",!0)]),o("div",Be,[e[30]||(e[30]=o("div",{class:"ui divider"},null,-1)),t.full?(s(),l("p",ze,[o("span",{class:"text",innerHTML:t.highlight(t.h.note,t.mySearch)},null,8,Pe),e[29]||(e[29]=o("br",null,null,-1))])):(s(),l("p",Ge,[o("span",{class:"text",innerHTML:t.highlight(t.part(t.h.note),t.mySearch)+"..."},null,8,je),e[28]||(e[28]=o("br",null,null,-1))]))])],8,me)),e[32]||(e[32]=o("div",{class:"filler"},null,-1)),o("div",{class:U(["ui bottom attached stackable buttons",{vertical:!t.full||t.thin}])},[o("div",{class:"ui purple button",onClick:e[6]||(e[6]=f=>t.locate(t.h,!0))},e[31]||(e[31]=[o("i",{class:"map icon"},null,-1),d("查看地圖")]))],2)])}const Oe=A({name:"NameCard",mixins:[D],props:{h:{type:Object,required:!0},mySearch:{type:String,required:!1,default:()=>""},full:{type:Boolean,required:!1,default:()=>!1},uid:{type:String,required:!1,default:()=>""},clickable:{type:Boolean,required:!1,default:()=>!0}},emits:["locate","loginGoogle","toggleLogin"],data(){return{thin:window.innerWidth<720}},methods:{isEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)},goto(t){!t.startsWith("http://")&&!t.startsWith("https://")&&(t="https://"+t),window.open(t)},locate:function(t,e){console.log(t),this.$emit("locate",t,e)},gotoMail(t){window.location.href=`mailto:${t}`},loginGoogle(t,e){this.$emit("loginGoogle",t,e)},toggleLogin(){this.$emit("toggleLogin")},copyFlagURL(t){if(!document.hasFocus()){alert("Document does not have focus, cannot copy link.");return}const e="https://we.alearn.org.tw/flag/"+t;navigator.clipboard.writeText(e).then(()=>{window.alert("已複製該名片")}).catch(u=>{console.error("無法複製該名片",u)}),this.$forceUpdate()}}}),Ze=R(Oe,[["render",We],["__scopeId","data-v-b03f9342"]]),Je={class:"hello"},Ke={key:0},Qe={key:1,class:"ui divider"},Xe={key:2},Ye={key:3},_e={key:4},$e={class:"ui grid container"},xe={key:0,class:"ui stackable two column row"},et={class:"ten wide column"},tt={class:"ui fluid card container"},ot={key:0,class:"filler"},it={class:"six wide column"},st={key:0},lt={key:1},nt={key:1,class:"filler"},rt={key:5,class:"ui container"},dt={key:0,class:"ui warning message"},ut={key:0},at={class:"ui form error warning success",id:"main-form"},ht={class:"field"},pt={key:0,class:"ui error message"},mt={key:1,class:"ui warning message"},gt={class:"field"},ft={class:"two fields"},vt={class:"field"},yt={key:0},kt=["href"],bt=["src","title","alt"],wt={class:"field"},Lt={key:0},Mt=["href"],Ut=["src","title","alt"],Nt={class:"two fields"},Tt={class:"field"},Ct={class:"field"},Vt={class:"field"},Ht=["value"],St={class:"field"},Dt=["value"],Ft={key:0},Rt={key:1,class:"ui warning message"},At={key:2,class:"ui error message"},qt={class:"field"},ct={key:0},Et={style:{"margin-left":"15px"}},It={key:1},Bt={class:"three fields"},Gt={class:"field"},jt={class:"field"},zt={class:"field"},Pt={class:"field"},Wt={class:"field"},Ot={key:0,class:"ui warning message"},Zt={key:1,class:"ui success message"},Jt={key:3,class:"warning"},Kt={key:4,class:"warning"},Qt={key:1},Xt={class:"ui vertical buttons"},Yt={key:0},_t={key:1};function $t(t,e,u,g,i,p){const k=T("router-link"),f=T("card");return s(),l("div",Je,[u.isInApp?(s(),l("p",Ke,"您正在 App 內使用，故無法登入，請使用一般瀏覽器登入。")):n("",!0),a(o("p",null,[e[22]||(e[22]=d("請先")),N(k,{target:"_blank",to:"/privacy-policy"},{default:M(()=>e[21]||(e[21]=[d("隱私權政策")])),_:1}),e[23]||(e[23]=d("請詳閱並同意"))],512),[[b,i.isNew]]),i.isNew?(s(),l("div",Qe)):n("",!0),i.isNew?(s(),l("br",Xe)):n("",!0),i.isNew?(s(),l("br",Ye)):n("",!0),i.isNew?(s(),l("br",_e)):n("",!0),o("div",$e,[i.editing?n("",!0):(s(),l("div",xe,[a(o("div",et,[a(o("div",tt,[N(f,{h:i.root,full:!0,onLocate:p.locate,onLoginGoogle:p.loginGoogle,uid:u.uid},null,8,["h","onLocate","onLoginGoogle","uid"])],512),[[b,!i.isNew&&!i.editing]])],512),[[b,!i.isNew]]),i.isNew?(s(),l("div",ot)):n("",!0),o("div",it,[a(o("div",{class:"ui massive blue button",onClick:e[0]||(e[0]=(...r)=>p.startEdit&&p.startEdit(...r))},[e[24]||(e[24]=o("i",{class:"edit icon"},null,-1)),e[25]||(e[25]=d("我要")),i.isNew?(s(),l("span",st,"升旗")):(s(),l("span",lt,"更新資料"))],512),[[b,u.uid&&!i.editing]])]),i.isNew?(s(),l("div",nt)):n("",!0)]))]),i.editing?(s(),l("div",rt,[p.longTimeNoSee()>.25&&!i.isNew?(s(),l("div",dt,[e[26]||(e[26]=o("div",{class:"header"},"您的資料已經一年未更新",-1)),p.longTimeNoSee()>.25?(s(),l("span",ut,"目前已被系統隱藏，請立即更新即可恢復顯示。")):n("",!0)])):n("",!0),a(o("form",at,[e[59]||(e[59]=o("h2",{class:"ui header"},"填寫資料",-1)),e[60]||(e[60]=o("div",{class:"sub header"},[d("請填寫以下資料"),o("br"),d("標示"),o("i",{class:"red star"}),d("為必填欄位")],-1)),e[61]||(e[61]=o("h4",{class:"ui dividing header"},"基本資料",-1)),o("div",ht,[e[27]||(e[27]=o("label",{class:"required"},"稱呼",-1)),a(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=r=>i.root.name=r),placeholder:"您希望別人如何稱呼您"},null,512),[[m,i.root.name]])]),o("div",{class:U(["field",{error:i.root.address&&(i.root.latlngColumn=="undefined,undefined"||i.root.latlngColumn=="36.778261,-119.4179324")}])},[e[30]||(e[30]=o("label",{class:"required"},"概略地址",-1)),a(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>i.root.address=r),placeholder:"請輸入地址"},null,512),[[m,i.root.address,void 0,{trim:!0}]]),i.root.address&&(i.root.latlngColumn=="undefined,undefined"||i.root.latlngColumn=="36.778261,-119.4179324")?(s(),l("div",pt,e[28]||(e[28]=[o("div",{class:"header"},"地址格式錯誤",-1),o("p",null,"請確認地址格式是否正確。",-1)]))):n("",!0),p.tooDetail(i.root.address)?(s(),l("div",mt,e[29]||(e[29]=[o("div",{class:"header"},"地址過於詳細",-1),o("p",null,"請提供更詳細的地址。",-1)]))):n("",!0)],2),e[62]||(e[62]=o("h4",{class:"ui header"},[d("地圖位置"),o("div",{class:"sub header"},"請在地圖上選擇位置")],-1)),e[63]||(e[63]=o("div",{id:"map",style:{height:"300px"}},null,-1)),e[64]||(e[64]=o("div",{class:"ui divider"},null,-1)),o("div",gt,[e[33]||(e[33]=o("label",null,"網站網址",-1)),o("div",ft,[o("div",vt,[a(o("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>i.root.site=r),placeholder:"請輸入個人網站網址"},null,512),[[m,i.root.site]]),i.root.site?(s(),l("span",yt,[o("a",{href:i.root.site,target:"_blank"},[o("img",{src:"https://www.google.com/s2/favicons?domain="+i.root.site,title:i.root.site,alt:i.root.site},null,8,bt),e[31]||(e[31]=d("測試連結"))],8,kt)])):n("",!0)]),o("div",wt,[a(o("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>i.root.site2=r),placeholder:"請輸入社群網站網址"},null,512),[[m,i.root.site2]]),i.root.site2?(s(),l("span",Lt,[o("a",{href:i.root.site2,target:"_blank"},[o("img",{src:"https://www.google.com/s2/favicons?domain="+i.root.site2,title:i.root.site2,alt:i.root.site2},null,8,Ut),e[32]||(e[32]=d("測試連結"))],8,Mt)])):n("",!0)])])]),o("div",Nt,[o("div",Tt,[e[34]||(e[34]=o("label",{class:"required"},"聯絡方式",-1)),a(o("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>i.root.connect_me=r),placeholder:"請輸入聯絡方式"},null,512),[[m,i.root.connect_me]])]),o("div",Ct,[e[35]||(e[35]=o("label",null,"空閒時間",-1)),a(o("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=r=>i.root.freetime=r),placeholder:"請輸入空閒時間"},null,512),[[m,i.root.freetime]])])]),e[65]||(e[65]=o("h4",{class:"ui dividing header"},"角色與類型",-1)),o("div",Vt,[e[37]||(e[37]=o("label",null,"角色",-1)),a(o("select",{class:"selectpicker","onUpdate:modelValue":e[7]||(e[7]=r=>i.root.learner_role=r)},[e[36]||(e[36]=o("option",{value:""},"-- 請選擇角色 --",-1)),(s(),l(C,null,V(["準會員","一般會員","理事","監事","常務理事","常務監事","理事長","其他"],r=>o("option",{value:r},h(r),9,Ht)),64))],512),[[H,i.root.learner_role]])]),o("div",St,[e[39]||(e[39]=o("label",null,"類型",-1)),a(o("select",{class:"selectpicker","onUpdate:modelValue":e[8]||(e[8]=r=>i.root.learner_type=r)},[e[38]||(e[38]=o("option",{value:""},"-- 請選擇類型 --",-1)),(s(),l(C,null,V(["準會員","一般會員","志工","教師","其他"],r=>o("option",{value:r},h(r),9,Dt)),64))],512),[[H,i.root.learner_type]])]),o("div",{class:U(["field",{error:t.badAge(i.root.learner_birth),warning:!i.root.learner_birth}])},[e[40]||(e[40]=o("label",{class:"required"},"出生年份",-1)),a(o("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=r=>i.root.learner_birth=r),placeholder:"請輸入出生年份"},null,512),[[m,i.root.learner_birth]])],2),i.root.learner_birth?(s(),l("span",Ft,"您已經 "+h(t.toAge(i.root.learner_birth))+" 歲",1)):n("",!0),i.root.learner_birth?n("",!0):(s(),l("div",Rt,e[41]||(e[41]=[o("div",{class:"header"},"出生年份未填寫",-1),o("p",null,"請填寫出生年份。",-1)]))),t.badAge(i.root.learner_birth)?(s(),l("div",At,e[42]||(e[42]=[o("div",{class:"header"},"出生年份格式錯誤",-1),o("p",null,"請確認出生年份格式是否正確。",-1)]))):n("",!0),o("div",qt,[e[55]||(e[55]=o("label",null,"最大孩子出生年份",-1)),o("span",null,[a(o("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>i.root.child_birth=r),type:"text",placeholder:"請輸入子女出生年份"},null,512),[[m,i.root.child_birth]]),e[46]||(e[46]=o("br",null,null,-1)),i.root.child_birth?(s(),l("span",ct,"您的孩子已經 "+h(t.toAge(i.root.child_birth))+" 歲",1)):n("",!0),e[47]||(e[47]=o("div",{class:"ui divider"},null,-1)),o("span",Et,[e[43]||(e[43]=d("最小孩子出生年份")),e[44]||(e[44]=o("br",null,null,-1)),a(o("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>i.root.child_birth2=r),type:"text",placeholder:"請輸入子女出生年份"},null,512),[[m,i.root.child_birth2]]),e[45]||(e[45]=o("br",null,null,-1))]),i.root.child_birth2?(s(),l("span",It,"您的子女出生於 "+h(t.toAge(i.root.child_birth2))+" 歲至 "+h(t.toAge(i.root.child_birth))+" 歲",1)):n("",!0)]),e[56]||(e[56]=o("div",{class:"ui divider"},null,-1)),o("div",Bt,[o("div",Gt,[e[48]||(e[48]=o("label",{class:"required"},"興趣",-1)),a(o("input",{"onUpdate:modelValue":e[12]||(e[12]=r=>i.root.learner_habit=r),placeholder:"請輸入興趣"},null,512),[[m,i.root.learner_habit]])]),o("div",jt,[e[49]||(e[49]=o("label",{class:"required"},"分享",-1)),a(o("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>i.root.share=r),placeholder:"請輸入分享"},null,512),[[m,i.root.share]])]),o("div",zt,[e[50]||(e[50]=o("label",null,"尋找",-1)),a(o("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>i.root.ask=r),placeholder:"請輸入詢問"},null,512),[[m,i.root.ask]])]),o("div",Pt,[e[51]||(e[51]=o("label",null,"可支付",-1)),a(o("input",{"onUpdate:modelValue":e[15]||(e[15]=r=>i.root.price=r),placeholder:"請輸入可支付"},null,512),[[m,i.root.price]])])]),o("div",Wt,[e[52]||(e[52]=o("label",{class:"required"},"自我介紹",-1)),a(o("textarea",{id:"note","onUpdate:modelValue":e[16]||(e[16]=r=>i.root.note=r),rows:"5",cols:"30",placeholder:"請輸入自我介紹"},null,512),[[m,i.root.note]])]),i.root.note&&i.root.note.length<20?(s(),l("div",Ot,e[53]||(e[53]=[o("div",{class:"header"},"自我介紹過短",-1),o("p",null,"請至少輸入 20 個字。",-1)]))):n("",!0),i.root.note&&i.root.note.length>=20?(s(),l("div",Zt,e[54]||(e[54]=[o("div",{class:"header"},"自我介紹已達標準",-1),o("p",null,"自我介紹已達到 20 個字以上。",-1)]))):n("",!0)]),!u.emailVerified&&i.root.login_method==="email"?(s(),l("div",Jt,[e[57]||(e[57]=d("note: 您的Email尚未驗證")),o("button",{class:"ui button",onClick:e[17]||(e[17]=r=>t.$emit("resendVerificationEmail"))},"按此重發驗證信")])):n("",!0),p.isValid(i.root)?n("",!0):(s(),l("div",Kt,e[58]||(e[58]=[d("note: 資料不完整"),o("i",{class:"red star"},null,-1),d("請確認所有欄位是否填寫完整。")])))],512),[[b,i.editing]]),i.isNew?(s(),l("p",Qt,[a(o("input",{class:"ui checkbox",type:"checkbox","onUpdate:modelValue":e[18]||(e[18]=r=>i.agree=r)},null,512),[[q,i.agree]]),e[67]||(e[67]=d("我已閱讀並同意")),N(k,{target:"_blank",to:"/privacy-policy"},{default:M(()=>e[66]||(e[66]=[d("隱私權政策")])),_:1})])):n("",!0),o("div",Xt,[o("button",{class:U(["ui large primary button",{disabled:!p.isValid(i.root)||!u.emailVerified&&i.root.login_method==="email"}]),onClick:e[19]||(e[19]=(...r)=>p.updateFlag&&p.updateFlag(...r))},[i.isNew?(s(),l("span",Yt,e[68]||(e[68]=[o("i",{class:"flag icon"},null,-1),d("升旗")]))):(s(),l("span",_t,e[69]||(e[69]=[o("i",{class:"flag icon"},null,-1),d("更新資料")])))],2),i.isNew?n("",!0):(s(),F(k,{key:0,class:"ui large basic primary button",to:"/flag/"+u.uid},{default:M(()=>e[70]||(e[70]=[o("i",{class:"user icon"},null,-1),d("檢查旗幟"),o("i",{class:"chevron right icon"},null,-1)])),_:1},8,["to"])),i.isNew?n("",!0):(s(),l("div",{key:1,class:"ui large red button",onClick:e[20]||(e[20]=(...r)=>p.confirmDelete&&p.confirmDelete(...r))},e[71]||(e[71]=[o("i",{class:"delete icon"},null,-1),d("刪除旗幟")])))]),e[72]||(e[72]=o("br",null,null,-1)),e[73]||(e[73]=o("br",null,null,-1)),e[74]||(e[74]=o("br",null,null,-1)),e[75]||(e[75]=o("br",null,null,-1))])):n("",!0)])}const xt={name:"MyFlag",props:["uid","user","emailVerified","email","mySearch","provider","photoURL","isInApp"],components:{Card:Ze},mixins:[D],metaInfo:{title:"個人資料"},data(){return{agree:!1,root:{latlngColumn:"23.5330,121.0654"},local:{},map:null,marker:null,isNew:!0,editing:!1}},emits:["loginGoogle","locate"],watch:{uid(t){t&&this.fetchUserData()}},mounted(){this.uid?this.fetchUserData():console.log("請先登入")},methods:{isValid(){return!this.root.note||this.root.note.length<20?!1:[this.root.name,this.root.address,this.root.connect_me,this.root.learner_birth,this.root.learner_habit,this.root.share,this.root.note].every(e=>e&&e.trim()!=="")},startEdit(){this.editing=!0,v.Icon.Default.imagePath="//cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/",setTimeout(this.initMap,500),setTimeout(this.setMapAndMarker,1e3),this.root.email||this.fetchUserData()},initMap(){let e=[23.533,121.0654];if(typeof this.root.latlngColumn=="string"){const u=this.root.latlngColumn.split(",");if(u.length===2){const g=parseFloat(u[0]),i=parseFloat(u[1]);!isNaN(g)&&!isNaN(i)&&(e=[g,i])}}this.map=v.map("map").setView(e,7),v.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),v.Icon.Default.imagePath="//cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/",this.marker=v.marker(this.map.getCenter(),{draggable:!0}).addTo(this.map),this.marker.on("dragend",()=>{const{lat:u,lng:g}=this.marker.getLatLng();this.map.setView({lat:u,lng:g}),this.root.latlngColumn=`${u.toFixed(5)},${g.toFixed(5)}`,this.$forceUpdate()})},fetchUserData(){const t=w(L,"users/"+this.uid);c(t).then(e=>{if(e.exists()){this.isNew=!1,this.root=e.val();let u=[...this.user&&this.user.providerData||[]];u.length===0&&(u=[{displayName:(this.root.email||"").split("@")[0]||"Unknown",email:this.root.email,photoURL:this.root.photoURL||"https://we.alearn.org.tw/logo-new.png"}]),this.root.email=this.root.email||this.email,this.root.connect_me=this.root.connect_me||this.email,this.root.name=this.root.name||this.user.name||u[0].displayName||"新朋友",this.root.photoURL=this.root.photoURL||decodeURI(this.user.photoURL)||"https://we.alearn.org.tw/logo-new.png",this.root.login_method=this.root.login_method||"google"}else{console.log("No data available for user: "+this.uid);let u=[...this.user&&this.user.providerData||[]];u.length===0&&(u=[{displayName:(this.root.email||"").split("@")[0]||"新朋友",email:this.root.email||"",photoURL:this.root.photoURL||"https://we.alearn.org.tw/logo-new.png",login_method:"email"}]),this.root={name:u[0].displayName,uid:this.uid,email:this.email,connect_me:this.email,photoURL:this.root.photoURL,latlngColumn:"23.5330,121.0654",note:"",login_method:this.root.login_method||"google"},this.isNew=!0}}).catch(e=>{console.error(e),console.log("No data available for user: "+this.uid),console.log(this.user);let u=[...this.user&&this.user.providerData||[]];u.length===0&&(u=[{displayName:(this.root.email||"").split("@")[0]||"新朋友",email:this.root.email||"",photoURL:this.root.photoURL||"https://we.alearn.org.tw/logo-new.png"}]),this.root={name:u[0].displayName,uid:this.uid,email:this.email,connect_me:this.email,photoURL:this.root.photoURL,latlngColumn:"23.5330,121.0654",note:"",login_method:this.root.login_method||"google"},this.isNew=!0})},setMapAndMarker(){if(this.map&&this.marker){let e=[23.533,121.0654];if(this.root&&typeof this.root.latlngColumn=="string"){const g=this.root.latlngColumn.split(",");if(g.length===2){const i=parseFloat(g[0]),p=parseFloat(g[1]);!isNaN(i)&&!isNaN(p)&&(e=[i,p])}}const u=v.latLng(e[0],e[1]);this.map.setView(u,7),this.marker.setLatLng(u)}},longTimeNoSee(){return this.root.lastUpdate?(new Date().getTime()-this.root.lastUpdate)/1e3/3600/24/365.25:1/0},tooDetail:function(t){return t?!!t.match(/(號|樓|F|f)/):!1},updateFlag:function(){if(this.root.email=this.email||"",this.root.uid=this.uid||"",this.root.photoURL=this.photoURL||"",this.root.lastUpdate=new Date().getTime(),!this.emailVerified&&this.root.login_method==="email"&&alert("Email尚未驗證"),!this.isNew)this.isNew=!1,this.editing=!1,S(w(L,"users/"+this.uid),this.root).then(alert("更新成功"));else if(this.agree)console.log("new2"),this.isNew=!1,this.editing=!1,S(w(L,"users/"+this.uid),this.root).then(alert("升旗成功"));else{window.alert("請先閱讀並同意隱私權政策");return}this.$emit("locate",this.root,!1)},confirmDelete(){window.confirm("確認要刪除旗幟嗎？此動作無法復原。")&&this.deleteFlag()},deleteFlag(){const t=this.uid;E(w(L,"users/"+t)).then(()=>{alert("刪除成功"),this.root={},this.$emit("logout")}).catch(e=>{alert("刪除失敗："+e.message)})},loginFB:function(){this.$emit("loginFB")},locate:function(t,e){this.$emit("locate",t,e)},loginGoogle:function(){this.$emit("loginGoogle")}}},oo=R(xt,[["render",$t],["__scopeId","data-v-53418988"]]);export{oo as default};
