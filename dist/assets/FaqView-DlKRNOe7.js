import{d as m,r as a,o as L,V as h,g as r,h as s,w as p,u as v,F as g,j as w,v as k,k as i,t as b,l as d,i as u,a5 as q,_ as C}from"./index-B5XOrBgH.js";const T=m({name:"FaqView",props:{uid:{type:String,required:!0}},setup(){const e=a([]),t=a(["全部","起步","計畫","支持","資源","其他"]),l=a(""),c=a("全部"),f=a(""),y=a(""),n=a("");return L(async()=>{try{const o=await h.get("https://members-backend.alearn13994229.workers.dev/api/Faq");e.value=o.data}catch(o){console.error("獲取FAQ資料失敗:",o)}}),{faqItems:e,categories:t,searchKeyword:l,selectedCategory:c,newLinkText:f,newLinkHref:y,showAddLinkId:n}},computed:{sortedFaqItems(){return this.faqItems.slice().sort((e,t)=>this.categories.indexOf(e.category)-this.categories.indexOf(t.category))},filteredAndSortedFaqItems(){const e=this.searchKeyword.toLowerCase().trim();let t=this.faqItems;return this.selectedCategory!=="全部"&&(t=t.filter(l=>l.category===this.selectedCategory)),e&&(t=t.filter(l=>l.category.toLowerCase().includes(e)||l.question.toLowerCase().includes(e)||l.answer.toLowerCase().includes(e))),t.sort((l,c)=>this.categories.indexOf(l.category)-this.categories.indexOf(c.category))}},methods:{toggleLogin(){this.$emit("toggleLogin")},fetchFaq(){this.faqItems=[],h.get("https://members-backend.alearn13994229.workers.dev/api/Faq").then(e=>{this.faqItems=e.data}).catch(e=>{console.error("獲取FAQ資料失敗:",e)})},parseLinks(e){return console.log(e),JSON.parse(e).filter(t=>t!=null&&t.t!=="")},parseAnswer(e){return console.log(e),e.replace(/\\n/g,`
`)},editFaq(e){console.log(e),this.$router.push(`/edit_faq/${e}`)},deleteFaq(e){console.log(e)},deleteLink(e,t){console.log(e,t),confirm("確定要刪除此連結嗎？")&&(console.log("刪除"),h.delete(`https://members-backend.alearn13994229.workers.dev/delete/faq/${e}/link/${t}`).then(()=>{window.alert("刪除成功"),console.log("刪除成功"),this.fetchFaq()}).catch(l=>{window.alert("刪除失敗"),console.error("刪除失敗:",l)}))},addLink(e){console.log(e);const t={t:this.newLinkText,h:this.newLinkHref};console.log(t),h.post(`https://members-backend.alearn13994229.workers.dev/insert/faq/${e}/link`,t).then(()=>{window.alert("新增成功"),this.newLinkText="",this.newLinkHref="",this.showAddLinkId="",console.log("新增成功"),this.fetchFaq()}).catch(l=>{window.alert("新增失敗"),console.error("新增失敗:",l)})},escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},highlightText(e){if(!this.searchKeyword.trim())return this.escapeHtml(e);const t=this.escapeHtml(e),l=this.escapeHtml(this.searchKeyword.toLowerCase().trim()),c=new RegExp(`(${l})`,"gi");return t.replace(c,'<span class="highlight">$1</span>')},showCategory(e){console.log(e),this.selectedCategory=e,this.$nextTick(()=>{this.searchKeyword=""})}}}),$={class:"faq-container"},H={class:"ui form"},F={class:"two stackable fields"},I={class:"field",style:{"max-width":"150px"}},A=["value"],M={class:"field"},V={class:"ui icon input"},K={class:"ui celled table"},S=["innerHTML","onClick"],O=["innerHTML"],N=["innerHTML"],U={class:"answer-cell"},B={key:0,class:"ui bulleted divided list"},D=["href"],E={class:"ui buttons",style:{margin:"0.8rem 0"}},Q=["href"],_=["onClick"],j={class:"item"},J=["onClick"],R={key:1,class:"item"},z={class:"ui form"},G={class:"ui buttons"},P=["href"],W=["src"],X=["onClick"],Y={class:"ui vertical buttons"},Z=["onClick"],x=["href"];function ee(e,t,l,c,f,y){return i(),r("div",$,[t[18]||(t[18]=s("h2",{class:"ui header"},"常見問題",-1)),s("form",H,[s("div",F,[s("div",I,[t[4]||(t[4]=s("label",null,"類別篩選",-1)),p(s("select",{class:"ui dropdown","onUpdate:modelValue":t[0]||(t[0]=n=>e.selectedCategory=n)},[(i(!0),r(g,null,w(e.categories,n=>(i(),r("option",{value:n},b(n),9,A))),256))],512),[[v,e.selectedCategory]])]),s("div",M,[t[6]||(t[6]=s("label",null,"關鍵字篩選",-1)),s("div",V,[p(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>e.searchKeyword=n),placeholder:"搜尋常見問題..."},null,512),[[k,e.searchKeyword]]),t[5]||(t[5]=s("i",{class:"search icon"},null,-1))])])])]),s("table",K,[t[17]||(t[17]=s("thead",null,[s("tr",null,[s("th",{class:"collapsing"},"類別"),s("th",null,"問題"),s("th",null,"回答"),s("th",null,"相關連結"),s("th",null,"操作")])],-1)),s("tbody",null,[(i(!0),r(g,null,w(e.filteredAndSortedFaqItems,n=>(i(),r("tr",{key:n.id},[s("td",{class:"collapsing clickable",innerHTML:e.highlightText(n.category),onClick:o=>e.showCategory(n.category)},null,8,S),s("td",{innerHTML:e.highlightText(n.question)},null,8,O),s("td",{class:"answer-cell",innerHTML:e.highlightText(e.parseAnswer(n.answer))},null,8,N),s("td",U,[n.links&&e.parseLinks(n.links).length>0?(i(),r("div",B,[(i(!0),r(g,null,w(e.parseLinks(n.links),o=>(i(),r("div",{class:"item",key:o.h},[s("a",{href:o.h,target:"_blank",rel:"noopener noreferrer"},b(o.t),9,D),t[9]||(t[9]=s("br",null,null,-1)),s("div",E,[o.h?(i(),r("a",{key:0,class:"ui basic teal button",href:o.h,target:"_blank",rel:"noopener noreferrer"},t[7]||(t[7]=[s("i",{class:"external link icon"},null,-1),d("測試")]),8,Q)):u("",!0),e.uid?(i(),r("button",{key:1,class:"ui button mini basic red icon",type:"button",onClick:te=>e.deleteLink(n.id,o.h)},t[8]||(t[8]=[s("i",{class:"trash icon"},null,-1),d("刪除")]),8,_)):u("",!0)])]))),128))])):u("",!0),t[14]||(t[14]=s("div",{class:"item ui divider"},null,-1)),s("div",j,[e.uid&&e.showAddLinkId!==n.id?(i(),r("button",{key:0,class:"ui button mini circular orange icon",type:"button",onClick:o=>e.showAddLinkId=n.id},t[10]||(t[10]=[s("i",{class:"plus icon"},null,-1),d("新增連結")]),8,J)):u("",!0)]),e.showAddLinkId===n.id?(i(),r("div",R,[s("div",z,[p(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>e.newLinkText=o),placeholder:"連結名稱"},null,512),[[k,e.newLinkText]]),p(s("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>e.newLinkHref=o),placeholder:"連結網址"},null,512),[[k,e.newLinkHref]]),t[13]||(t[13]=s("br",null,null,-1)),s("div",G,[e.newLinkHref?(i(),r("a",{key:0,class:"ui basic primary button",href:e.newLinkHref,target:"_blank",rel:"noopener noreferrer"},[s("img",{src:"https://www.google.com/s2/favicons?domain="+e.newLinkHref,alt:"測試連結"},null,8,W),t[11]||(t[11]=d("測試連結"))],8,P)):u("",!0),s("button",{class:"ui button primary",type:"button",onClick:q(o=>e.addLink(n.id),["prevent"])},t[12]||(t[12]=[s("i",{class:"plus icon"},null,-1),d("新增連結")]),8,X)])])])):u("",!0)]),s("td",null,[s("div",Y,[e.uid?(i(),r("button",{key:0,class:"ui button primary",type:"button",onClick:o=>e.editFaq(n.id)},t[15]||(t[15]=[s("i",{class:"pencil icon"},null,-1),d("編輯")]),8,Z)):u("",!0),s("a",{class:"ui basic button secondary",href:`https://map.alearn.org.tw/ans/${n.id}`},t[16]||(t[16]=[d("前往"),s("i",{class:"chevron right icon"},null,-1)]),8,x)])])]))),128))])])])}const ne=C(T,[["render",ee],["__scopeId","data-v-b015559a"]]);export{ne as default};
