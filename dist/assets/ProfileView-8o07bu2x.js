import{C as ge}from"./Card-REIjq2bT.js";import{ad as de,c as O,d as j,w as W,a1 as K,b as l,f as Y,ae as ie,V as ne,e as V,n as oe,F as ae,r as se,v as Ae,t as J,af as ce,U as me,W as le,o as H,_ as pe,a3 as ee,a5 as te,ag as ve,a2 as ue,ah as Ie}from"./index-B-UgqAhp.js";import{l as Z}from"./leaflet-src-CV8K3Q8L.js";import"./mix-O88PJOmL.js";const we={methods:{toList(_){return!_||typeof _!="object"?[]:Object.values(_)},part(_){return String(_).substring(0,100)},toAge(_){return new Date().getFullYear()-parseInt(_)},highlight(_,e){if(!_)return"";if(_=_.replace(/</g,"&lt;").replace(/>/g,"&gt;"),_=_.replace(/&lt;\s*br\/?\s*&gt;/g,"<br/>"),!e||e.startsWith("$"))return _;const m=e.split(/\s+/g);for(const B of m)_=_.replace(new RegExp(B,"gi"),'<span class="highlightedText">$&</span>');return _},getIcon(_){return _&&_.photoURL?_.photoURL:_&&_.name?`https://www.moedict.tw/${_.name}.png`:"https://www.moedict.tw/unknown.png"},countDateDiff(_){return _?new Date(_).toLocaleDateString():""},makeHref(_){if(!_)return"";let e=String(_);return!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e.replace("https://","")},badAge(_){if(!_)return!1;const m=new Date().getFullYear()-parseInt(_);return isNaN(m)},isValid(_){return _&&_.name&&_.share&&_.learner_habit&&_.note&&_.address&&_.latlngColumn!=="undefined,undefined"&&_.latlngColumn!=="36.778261,-119.4179324"&&_.connect_me},asValid(_){return _&&_.name&&_.note&&_.note.length>=20&&_.address&&_.latlngColumn!=="undefined,undefined"&&_.latlngColumn!=="36.778261,-119.4179324"},searchBy(_,e){const B=Object.keys(_).map(f=>_[f]);if(!B)return[];e||(e="");const o=e.split(/[\s&]+/g);let d=B;for(const f of o){let n,t;[n,t]=f.split(/[~-]/),f.match(/(\d+)[~-](\d+)/)?d=d.filter(i=>(this.toAge(i.learner_birth)<=Number(t)&&this.toAge(i.learner_birth))>=n||this.toAge(i.child_birth)<=Number(t)&&this.toAge(i.child_birth)>=n||this.toAge(i.child_birth2)<=Number(t)&&this.toAge(i.child_birth2)>=n):f.match(/(\d+)\+/)?(n=f.split("+")[0],d=d.filter(i=>this.toAge(i.learner_birth)>=Number(n)||this.toAge(i.child_birth)>=Number(n)||this.toAge(i.child_birth2)>=Number(n))):f.match(/(\d+)-/)?(t=f.split("-")[0],d=d.filter(i=>this.toAge(i.learner_birth)<=Number(t)||this.toAge(i.child_birth)<=Number(t)||this.toAge(i.child_birth2)<=Number(t))):d=d.filter(i=>i.name?(i.name+i.address+i.note+i.freetime+i.learner_habit+i.share+i.ask+i.id).includes(f):!1)}return d.sort((f,n)=>(f.lastUpdate||(f.lastUpdate=0),n.lastUpdate||(n.lastUpdate=0),n.lastUpdate-f.lastUpdate)),d}}};function re(_){throw new Error('Could not dynamically require "'+_+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fe={exports:{}};/*!

pica
https://github.com/nodeca/pica

*/(function(_,e){(function(m){_.exports=m()})(function(){return function(){function m(B,o,d){function f(i,A){if(!o[i]){if(!B[i]){var r=typeof re=="function"&&re;if(!A&&r)return r(i,!0);if(n)return n(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var b=o[i]={exports:{}};B[i][0].call(b.exports,function(u){var g=B[i][1][u];return f(g||u)},b,b.exports,m,B,o,d)}return o[i].exports}for(var n=typeof re=="function"&&re,t=0;t<d.length;t++)f(d[t]);return f}return m}()({1:[function(m,B,o){var d=m("multimath"),f=m("./mm_unsharp_mask"),n=m("./mm_resize");function t(i){var A=i||[],r={js:A.indexOf("js")>=0,wasm:A.indexOf("wasm")>=0};d.call(this,r),this.features={js:r.js,wasm:r.wasm&&this.has_wasm()},this.use(f),this.use(n)}t.prototype=Object.create(d.prototype),t.prototype.constructor=t,t.prototype.resizeAndUnsharp=function(A,r){var a=this.resize(A,r);return A.unsharpAmount&&this.unsharp_mask(a,A.toWidth,A.toHeight,A.unsharpAmount,A.unsharpRadius,A.unsharpThreshold),a},B.exports=t},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(m,B,o){function d(r){return r<0?0:r>255?255:r}function f(r){return r>=0?r:0}function n(r,a,b,u,g,c){var v,w,E,Q,D,x,G,y,U,M,k,S=0,R=0;for(U=0;U<u;U++){for(D=0,M=0;M<g;M++){for(x=c[D++],G=c[D++],y=S+x*4|0,v=w=E=Q=0;G>0;G--)k=c[D++],Q=Q+k*r[y+3]|0,E=E+k*r[y+2]|0,w=w+k*r[y+1]|0,v=v+k*r[y]|0,y=y+4|0;a[R+3]=f(Q>>7),a[R+2]=f(E>>7),a[R+1]=f(w>>7),a[R]=f(v>>7),R=R+u*4|0}R=(U+1)*4|0,S=(U+1)*b*4|0}}function t(r,a,b,u,g,c){var v,w,E,Q,D,x,G,y,U,M,k,S=0,R=0;for(U=0;U<u;U++){for(D=0,M=0;M<g;M++){for(x=c[D++],G=c[D++],y=S+x*4|0,v=w=E=Q=0;G>0;G--)k=c[D++],Q=Q+k*r[y+3]|0,E=E+k*r[y+2]|0,w=w+k*r[y+1]|0,v=v+k*r[y]|0,y=y+4|0;v>>=7,w>>=7,E>>=7,Q>>=7,a[R+3]=d(Q+8192>>14),a[R+2]=d(E+8192>>14),a[R+1]=d(w+8192>>14),a[R]=d(v+8192>>14),R=R+u*4|0}R=(U+1)*4|0,S=(U+1)*b*4|0}}function i(r,a,b,u,g,c){var v,w,E,Q,D,x,G,y,U,M,k,S,R=0,T=0;for(M=0;M<u;M++){for(x=0,k=0;k<g;k++){for(G=c[x++],y=c[x++],U=R+G*4|0,v=w=E=Q=0;y>0;y--)S=c[x++],D=r[U+3],Q=Q+S*D|0,E=E+S*r[U+2]*D|0,w=w+S*r[U+1]*D|0,v=v+S*r[U]*D|0,U=U+4|0;E=E/255|0,w=w/255|0,v=v/255|0,a[T+3]=f(Q>>7),a[T+2]=f(E>>7),a[T+1]=f(w>>7),a[T]=f(v>>7),T=T+u*4|0}T=(M+1)*4|0,R=(M+1)*b*4|0}}function A(r,a,b,u,g,c){var v,w,E,Q,D,x,G,y,U,M,k,S=0,R=0;for(U=0;U<u;U++){for(D=0,M=0;M<g;M++){for(x=c[D++],G=c[D++],y=S+x*4|0,v=w=E=Q=0;G>0;G--)k=c[D++],Q=Q+k*r[y+3]|0,E=E+k*r[y+2]|0,w=w+k*r[y+1]|0,v=v+k*r[y]|0,y=y+4|0;v>>=7,w>>=7,E>>=7,Q>>=7,Q=d(Q+8192>>14),Q>0&&(v=v*255/Q|0,w=w*255/Q|0,E=E*255/Q|0),a[R+3]=Q,a[R+2]=d(E+8192>>14),a[R+1]=d(w+8192>>14),a[R]=d(v+8192>>14),R=R+u*4|0}R=(U+1)*4|0,S=(U+1)*b*4|0}}B.exports={convolveHor:n,convolveVert:t,convolveHorWithPre:i,convolveVertWithPre:A}},{}],3:[function(m,B,o){B.exports="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"},{}],4:[function(m,B,o){B.exports={name:"resize",fn:m("./resize"),wasm_fn:m("./resize_wasm"),wasm_src:m("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(m,B,o){var d=m("./resize_filter_gen"),f=m("./convolve"),n=f.convolveHor,t=f.convolveVert,i=f.convolveHorWithPre,A=f.convolveVertWithPre;function r(b,u,g){for(var c=3,v=u*g*4|0;c<v;){if(b[c]!==255)return!0;c=c+4|0}return!1}function a(b,u,g){for(var c=3,v=u*g*4|0;c<v;)b[c]=255,c=c+4|0}B.exports=function(u){var g=u.src,c=u.width,v=u.height,w=u.toWidth,E=u.toHeight,Q=u.scaleX||u.toWidth/u.width,D=u.scaleY||u.toHeight/u.height,x=u.offsetX||0,G=u.offsetY||0,y=u.dest||new Uint8Array(w*E*4),U=typeof u.filter>"u"?"mks2013":u.filter,M=d(U,c,w,Q,x),k=d(U,v,E,D,G),S=new Uint16Array(w*v*4);return r(g,c,v)?(i(g,S,c,v,w,M),A(S,y,v,w,E,k)):(n(g,S,c,v,w,M),t(S,y,v,w,E,k),a(y,w,E)),y}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(m,B,o){var d=m("./resize_filter_info"),f=14;function n(t){return Math.round(t*((1<<f)-1))}B.exports=function(i,A,r,a,b){var u=d.filter[i].fn,g=1/a,c=Math.min(1,a),v=d.filter[i].win/c,w,E,Q,D,x,G,y,U,M,k,S,R,T,P,s,p,h,C=Math.floor((v+1)*2),I=new Int16Array((C+2)*r),L=0,F=!I.subarray||!I.set;for(w=0;w<r;w++){for(E=(w+.5)*g+b,Q=Math.max(0,Math.floor(E-v)),D=Math.min(A-1,Math.ceil(E+v)),x=D-Q+1,G=new Float32Array(x),y=new Int16Array(x),U=0,M=Q,k=0;M<=D;M++,k++)S=u((M+.5-E)*c),U+=S,G[k]=S;for(R=0,k=0;k<G.length;k++)T=G[k]/U,R+=T,y[k]=n(T);for(y[r>>1]+=n(1-R),P=0;P<y.length&&y[P]===0;)P++;if(P<y.length){for(s=y.length-1;s>0&&y[s]===0;)s--;if(p=Q+P,h=s-P+1,I[L++]=p,I[L++]=h,!F)I.set(y.subarray(P,s+1),L),L+=h;else for(k=P;k<=s;k++)I[L++]=y[k]}else I[L++]=0,I[L++]=0}return I}},{"./resize_filter_info":7}],7:[function(m,B,o){var d={box:{win:.5,fn:function(n){return n<0&&(n=-n),n<.5?1:0}},hamming:{win:1,fn:function(n){if(n<0&&(n=-n),n>=1)return 0;if(n<11920929e-14)return 1;var t=n*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},lanczos2:{win:2,fn:function(n){if(n<0&&(n=-n),n>=2)return 0;if(n<11920929e-14)return 1;var t=n*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},lanczos3:{win:3,fn:function(n){if(n<0&&(n=-n),n>=3)return 0;if(n<11920929e-14)return 1;var t=n*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}},mks2013:{win:2.5,fn:function(n){return n<0&&(n=-n),n>=2.5?0:n>=1.5?-.125*(n-2.5)*(n-2.5):n>=.5?.25*(4*n*n-11*n+7):1.0625-1.75*n*n}}};B.exports={filter:d,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(m,B,o){var d=m("./resize_filter_gen");function f(r,a,b){for(var u=3,g=a*b*4|0;u<g;){if(r[u]!==255)return!0;u=u+4|0}return!1}function n(r,a,b){for(var u=3,g=a*b*4|0;u<g;)r[u]=255,u=u+4|0}function t(r){return new Uint8Array(r.buffer,0,r.byteLength)}var i=!0;try{i=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch{}function A(r,a,b){if(i){a.set(t(r),b);return}for(var u=b,g=0;g<r.length;g++){var c=r[g];a[u++]=c&255,a[u++]=c>>8&255}}B.exports=function(a){var b=a.src,u=a.width,g=a.height,c=a.toWidth,v=a.toHeight,w=a.scaleX||a.toWidth/a.width,E=a.scaleY||a.toHeight/a.height,Q=a.offsetX||0,D=a.offsetY||0,x=a.dest||new Uint8Array(c*v*4),G=typeof a.filter>"u"?"mks2013":a.filter,y=d(G,u,c,w,Q),U=d(G,g,v,E,D),M=0,k=Math.max(b.byteLength,x.byteLength),S=this.__align(M+k),R=g*c*4*2,T=this.__align(S+R),P=this.__align(T+y.byteLength),s=P+U.byteLength,p=this.__instance("resize",s),h=new Uint8Array(this.__memory.buffer),C=new Uint32Array(this.__memory.buffer),I=new Uint32Array(b.buffer);C.set(I),A(y,h,T),A(U,h,P);var L=p.exports.convolveHV||p.exports._convolveHV;f(b,u,g)?L(T,P,S,u,g,c,v,1):(L(T,P,S,u,g,c,v,0),n(x,c,v));var F=new Uint32Array(x.buffer);return F.set(new Uint32Array(this.__memory.buffer,0,v*c)),x}},{"./resize_filter_gen":6}],9:[function(m,B,o){B.exports={name:"unsharp_mask",fn:m("./unsharp_mask"),wasm_fn:m("./unsharp_mask_wasm"),wasm_src:m("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(m,B,o){var d=m("glur/mono16");function f(n,t,i){for(var A=t*i,r=new Uint16Array(A),a,b,u,g,c=0;c<A;c++)a=n[4*c],b=n[4*c+1],u=n[4*c+2],g=a>=b&&a>=u?a:b>=u&&b>=a?b:u,r[c]=g<<8;return r}B.exports=function(t,i,A,r,a,b){var u,g,c,v,w;if(!(r===0||a<.5)){a>2&&(a=2);var E=f(t,i,A),Q=new Uint16Array(E);d(Q,i,A,a);for(var D=r/100*4096+.5|0,x=b<<8,G=i*A,y=0;y<G;y++)u=E[y],v=u-Q[y],Math.abs(v)>=x&&(g=u+(D*v+2048>>12),g=g>65280?65280:g,g=g<0?0:g,u=u!==0?u:1,c=(g<<12)/u|0,w=y*4,t[w]=t[w]*c+2048>>12,t[w+1]=t[w+1]*c+2048>>12,t[w+2]=t[w+2]*c+2048>>12)}}},{"glur/mono16":18}],11:[function(m,B,o){B.exports=function(f,n,t,i,A,r){if(!(i===0||A<.5)){A>2&&(A=2);var a=n*t,b=a*4,u=a*2,g=a*2,c=Math.max(n,t)*4,v=8*4,w=0,E=b,Q=E+u,D=Q+g,x=D+g,G=x+c,y=this.__instance("unsharp_mask",b+u+g*2+c+v,{exp:Math.exp}),U=new Uint32Array(f.buffer),M=new Uint32Array(this.__memory.buffer);M.set(U);var k=y.exports.hsv_v16||y.exports._hsv_v16;k(w,E,n,t),k=y.exports.blurMono16||y.exports._blurMono16,k(E,Q,D,x,G,n,t,A),k=y.exports.unsharp||y.exports._unsharp,k(w,w,E,Q,n,t,i,r),U.set(new Uint32Array(this.__memory.buffer,0,a))}}},{}],12:[function(m,B,o){B.exports="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"},{}],13:[function(m,B,o){var d=100;function f(n,t){this.create=n,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}f.prototype.acquire=function(){var n=this,t;return this.available.length!==0?t=this.available.pop():(t=this.create(),t.id=this.lastId++,t.release=function(){return n.release(t)}),this.acquired[t.id]=t,t},f.prototype.release=function(n){var t=this;delete this.acquired[n.id],n.lastUsed=Date.now(),this.available.push(n),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return t.gc()},d))},f.prototype.gc=function(){var n=this,t=Date.now();this.available=this.available.filter(function(i){return t-i.lastUsed>n.idle?(i.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return n.gc()},d):this.timeoutId=0},B.exports=f},{}],14:[function(m,B,o){var d=2;B.exports=function(n,t,i,A,r,a){var b=i/n,u=A/t,g=(2*a+d+1)/r;if(g>.5)return[[i,A]];var c=Math.ceil(Math.log(Math.min(b,u))/Math.log(g));if(c<=1)return[[i,A]];for(var v=[],w=0;w<c;w++){var E=Math.round(Math.pow(Math.pow(n,c-w-1)*Math.pow(i,w+1),1/c)),Q=Math.round(Math.pow(Math.pow(t,c-w-1)*Math.pow(A,w+1),1/c));v.push([E,Q])}return v}},{}],15:[function(m,B,o){var d=1e-5;function f(t){var i=Math.round(t);return Math.abs(t-i)<d?i:Math.floor(t)}function n(t){var i=Math.round(t);return Math.abs(t-i)<d?i:Math.ceil(t)}B.exports=function(i){var A=i.toWidth/i.width,r=i.toHeight/i.height,a=f(i.srcTileSize*A)-2*i.destTileBorder,b=f(i.srcTileSize*r)-2*i.destTileBorder;if(a<1||b<1)throw new Error("Internal error in pica: target tile width/height is too small.");var u,g,c,v,w,E,Q=[],D;for(v=0;v<i.toHeight;v+=b)for(c=0;c<i.toWidth;c+=a)u=c-i.destTileBorder,u<0&&(u=0),w=c+a+i.destTileBorder-u,u+w>=i.toWidth&&(w=i.toWidth-u),g=v-i.destTileBorder,g<0&&(g=0),E=v+b+i.destTileBorder-g,g+E>=i.toHeight&&(E=i.toHeight-g),D={toX:u,toY:g,toWidth:w,toHeight:E,toInnerX:c,toInnerY:v,toInnerWidth:a,toInnerHeight:b,offsetX:u/A-f(u/A),offsetY:g/r-f(g/r),scaleX:A,scaleY:r,x:f(u/A),y:f(g/r),width:n(w/A),height:n(E/r)},Q.push(D);return Q}},{}],16:[function(m,B,o){function d(f){return Object.prototype.toString.call(f)}B.exports.isCanvas=function(n){var t=d(n);return t==="[object HTMLCanvasElement]"||t==="[object OffscreenCanvas]"||t==="[object Canvas]"},B.exports.isImage=function(n){return d(n)==="[object HTMLImageElement]"},B.exports.isImageBitmap=function(n){return d(n)==="[object ImageBitmap]"},B.exports.limiter=function(n){var t=0,i=[];function A(){t<n&&i.length&&(t++,i.shift()())}return function(a){return new Promise(function(b,u){i.push(function(){a().then(function(g){b(g),t--,A()},function(g){u(g),t--,A()})}),A()})}},B.exports.cib_quality_name=function(n){switch(n){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},B.exports.cib_support=function(n){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var t=n(100,100);return createImageBitmap(t,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(i){var A=i.width===10;return i.close(),t=null,A})}).catch(function(){return!1})},B.exports.worker_offscreen_canvas_support=function(){return new Promise(function(n,t){if(typeof OffscreenCanvas>"u"){n(!1);return}function i(a){if(typeof createImageBitmap>"u"){a.postMessage(!1);return}Promise.resolve().then(function(){var b=new OffscreenCanvas(10,10),u=b.getContext("2d");return u.rect(0,0,1,1),createImageBitmap(b,0,0,1,1)}).then(function(){return a.postMessage(!0)},function(){return a.postMessage(!1)})}var A=btoa("(".concat(i.toString(),")(self);")),r=new Worker("data:text/javascript;base64,".concat(A));r.onmessage=function(a){return n(a.data)},r.onerror=t}).then(function(n){return n},function(){return!1})},B.exports.can_use_canvas=function(n){var t=!1;try{var i=n(2,1),A=i.getContext("2d"),r=A.createImageData(2,1);r.data[0]=12,r.data[1]=23,r.data[2]=34,r.data[3]=255,r.data[4]=45,r.data[5]=56,r.data[6]=67,r.data[7]=255,A.putImageData(r,0,0),r=null,r=A.getImageData(0,0,2,1),r.data[0]===12&&r.data[1]===23&&r.data[2]===34&&r.data[3]===255&&r.data[4]===45&&r.data[5]===56&&r.data[6]===67&&r.data[7]===255&&(t=!0)}catch{}return t},B.exports.cib_can_use_region=function(){return new Promise(function(n){if(typeof Image>"u"||typeof createImageBitmap>"u"){n(!1);return}var t=new Image;t.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",t.onload=function(){createImageBitmap(t,0,0,t.width,t.height).then(function(i){i.width===t.width&&i.height===t.height?n(!0):n(!1)},function(){return n(!1)})},t.onerror=function(){return n(!1)}})}},{}],17:[function(m,B,o){B.exports=function(){var d=m("./mathlib"),f;onmessage=function(t){var i=t.data.opts;if(!i.src&&i.srcBitmap){var A=new OffscreenCanvas(i.width,i.height),r=A.getContext("2d");r.drawImage(i.srcBitmap,0,0),i.src=r.getImageData(0,0,i.width,i.height).data,A.width=A.height=0,A=null,i.srcBitmap.close(),i.srcBitmap=null}f||(f=new d(t.data.features));var a=f.resizeAndUnsharp(i);postMessage({data:a},[a.buffer])}}},{"./mathlib":1}],18:[function(m,B,o){var d,f,n,t,i,A,r,a;function b(c){c<.5&&(c=.5);var v=Math.exp(.726*.726)/c,w=Math.exp(-v),E=Math.exp(-2*v),Q=(1-w)*(1-w)/(1+2*v*w-E);return d=Q,f=Q*(v-1)*w,n=Q*(v+1)*w,t=-Q*E,i=2*w,A=-E,r=(d+f)/(1-i-A),a=(n+t)/(1-i-A),new Float32Array([d,f,n,t,i,A,r,a])}function u(c,v,w,E,Q,D){var x,G,y,U,M,k,S,R,T,P,s,p,h,C;for(T=0;T<D;T++){for(k=T*Q,S=T,R=0,x=c[k],M=x*E[6],U=M,s=E[0],p=E[1],h=E[4],C=E[5],P=0;P<Q;P++)G=c[k],y=G*s+x*p+U*h+M*C,M=U,U=y,x=G,w[R]=U,R++,k++;for(k--,R--,S+=D*(Q-1),x=c[k],M=x*E[7],U=M,G=x,s=E[2],p=E[3],P=Q-1;P>=0;P--)y=G*s+x*p+U*h+M*C,M=U,U=y,x=G,G=c[k],v[S]=w[R]+U,k--,R--,S-=D}}function g(c,v,w,E){if(E){var Q=new Uint16Array(c.length),D=new Float32Array(Math.max(v,w)),x=b(E);u(c,Q,D,x,v,w),u(Q,c,D,x,w,v)}}B.exports=g},{}],19:[function(m,B,o){var d=m("object-assign"),f=m("./lib/base64decode"),n=m("./lib/wa_detect"),t={js:!0,wasm:!0};function i(A){if(!(this instanceof i))return new i(A);var r=d({},t,A||{});if(this.options=r,this.__cache={},this.__init_promise=null,this.__modules=r.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}i.prototype.has_wasm=n,i.prototype.use=function(A){return this.__modules[A.name]=A,this.options.wasm&&this.has_wasm()&&A.wasm_fn?this[A.name]=A.wasm_fn:this[A.name]=A.fn,this},i.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var A=this;return this.__init_promise=Promise.all(Object.keys(A.__modules).map(function(r){var a=A.__modules[r];return!A.options.wasm||!A.has_wasm()||!a.wasm_fn||A.__wasm[r]?null:WebAssembly.compile(A.__base64decode(a.wasm_src)).then(function(b){A.__wasm[r]=b})})).then(function(){return A}),this.__init_promise},i.prototype.__base64decode=f,i.prototype.__reallocate=function(r){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(r/(64*1024))}),this.__memory;var a=this.__memory.buffer.byteLength;return a<r&&this.__memory.grow(Math.ceil((r-a)/(64*1024))),this.__memory},i.prototype.__instance=function(r,a,b){if(a&&this.__reallocate(a),!this.__wasm[r]){var u=this.__modules[r];this.__wasm[r]=new WebAssembly.Module(this.__base64decode(u.wasm_src))}if(!this.__cache[r]){var g={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[r]=new WebAssembly.Instance(this.__wasm[r],{env:d(g,b||{})})}return this.__cache[r]},i.prototype.__align=function(r,a){a=a||8;var b=r%a;return r+(b?a-b:0)},B.exports=i},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(m,B,o){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";B.exports=function(n){for(var t=n.replace(/[\r\n=]/g,""),i=t.length,A=new Uint8Array(i*3>>2),r=0,a=0,b=0;b<i;b++)b%4===0&&b&&(A[a++]=r>>16&255,A[a++]=r>>8&255,A[a++]=r&255),r=r<<6|d.indexOf(t.charAt(b));var u=i%4*6;return u===0?(A[a++]=r>>16&255,A[a++]=r>>8&255,A[a++]=r&255):u===18?(A[a++]=r>>10&255,A[a++]=r>>2&255):u===12&&(A[a++]=r>>4&255),A}},{}],21:[function(m,B,o){var d;B.exports=function(){if(typeof d<"u"||(d=!1,typeof WebAssembly>"u"))return d;try{var n=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(n),i=new WebAssembly.Instance(t,{});return i.exports.test(4)!==0&&(d=!0),d}catch{}return d}},{}],22:[function(m,B,o){var d=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function t(A){if(A==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(A)}function i(){try{if(!Object.assign)return!1;var A=new String("abc");if(A[5]="de",Object.getOwnPropertyNames(A)[0]==="5")return!1;for(var r={},a=0;a<10;a++)r["_"+String.fromCharCode(a)]=a;var b=Object.getOwnPropertyNames(r).map(function(g){return r[g]});if(b.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(g){u[g]=g}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}B.exports=i()?Object.assign:function(A,r){for(var a,b=t(A),u,g=1;g<arguments.length;g++){a=Object(arguments[g]);for(var c in a)f.call(a,c)&&(b[c]=a[c]);if(d){u=d(a);for(var v=0;v<u.length;v++)n.call(a,u[v])&&(b[u[v]]=a[u[v]])}}return b}},{}],23:[function(m,B,o){var d=arguments[3],f=arguments[4],n=arguments[5],t=JSON.stringify;B.exports=function(i,A){for(var r,a=Object.keys(n),b=0,u=a.length;b<u;b++){var g=a[b],c=n[g].exports;if(c===i||c&&c.default===i){r=g;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var v={},b=0,u=a.length;b<u;b++){var g=a[b];v[g]=g}f[r]=["function(require,module,exports){"+i+"(self); }",v]}var w=Math.floor(Math.pow(16,8)*Math.random()).toString(16),E={};E[r]=r,f[w]=["function(require,module,exports){var f = require("+t(r)+");(f.default ? f.default : f)(self);}",E];var Q={};D(w);function D(k){Q[k]=!0;for(var S in f[k][1]){var R=f[k][1][S];Q[R]||D(R)}}var x="("+d+")({"+Object.keys(Q).map(function(k){return t(k)+":["+f[k][0]+","+t(f[k][1])+"]"}).join(",")+"},{},["+t(w)+"])",G=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([x],{type:"text/javascript"});if(A&&A.bare)return y;var U=G.createObjectURL(y),M=new Worker(U);return M.objectURL=U,M}},{}],"/index.js":[function(m,B,o){function d(s,p){return A(s)||i(s,p)||n(s,p)||f()}function f(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n(s,p){if(s){if(typeof s=="string")return t(s,p);var h=Object.prototype.toString.call(s).slice(8,-1);if(h==="Object"&&s.constructor&&(h=s.constructor.name),h==="Map"||h==="Set")return Array.from(s);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return t(s,p)}}function t(s,p){(p==null||p>s.length)&&(p=s.length);for(var h=0,C=new Array(p);h<p;h++)C[h]=s[h];return C}function i(s,p){var h=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(h!=null){var C=[],I=!0,L=!1,F,N;try{for(h=h.call(s);!(I=(F=h.next()).done)&&(C.push(F.value),!(p&&C.length===p));I=!0);}catch(q){L=!0,N=q}finally{try{!I&&h.return!=null&&h.return()}finally{if(L)throw N}}return C}}function A(s){if(Array.isArray(s))return s}var r=m("object-assign"),a=m("webworkify"),b=m("./lib/mathlib"),u=m("./lib/pool"),g=m("./lib/utils"),c=m("./lib/worker"),v=m("./lib/stepper"),w=m("./lib/tiler"),E=m("./lib/mm_resize/resize_filter_info"),Q={},D=!1;try{typeof navigator<"u"&&navigator.userAgent&&(D=navigator.userAgent.indexOf("Safari")>=0)}catch{}var x=1;typeof navigator<"u"&&(x=Math.min(navigator.hardwareConcurrency||1,4));var G={tile:1024,concurrency:x,features:["js","wasm","ww"],idle:2e3,createCanvas:function(p,h){var C=document.createElement("canvas");return C.width=p,C.height=h,C}},y={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},U=!1,M=!1,k=!1,S=!1,R=!1;function T(){return{value:a(c),destroy:function(){if(this.value.terminate(),typeof window<"u"){var p=window.URL||window.webkitURL||window.mozURL||window.msURL;p&&p.revokeObjectURL&&this.value.objectURL&&p.revokeObjectURL(this.value.objectURL)}}}}function P(s){if(!(this instanceof P))return new P(s);this.options=r({},G,s||{});var p="lk_".concat(this.options.concurrency);this.__limit=Q[p]||g.limiter(this.options.concurrency),Q[p]||(Q[p]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}P.prototype.init=function(){var s=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),U=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?M=!0:this.debug("ImageBitmap does not support .close(), disabled"));var p=this.options.features.slice();if(p.indexOf("all")>=0&&(p=["cib","wasm","js","ww"]),this.__requested_features=p,this.__mathlib=new b(p),p.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{var h=m("webworkify")(function(){});h.terminate(),this.features.ww=!0;var C="wp_".concat(JSON.stringify(this.options));Q[C]?this.__workersPool=Q[C]:(this.__workersPool=new u(T,this.options.idle),Q[C]=this.__workersPool)}catch{}var I=this.__mathlib.init().then(function(q){r(s.features,q.features)}),L;M?L=g.cib_support(this.options.createCanvas).then(function(q){if(s.features.cib&&p.indexOf("cib")<0){s.debug("createImageBitmap() resize supported, but disabled by config");return}p.indexOf("cib")>=0&&(s.features.cib=q)}):L=Promise.resolve(!1),k=g.can_use_canvas(this.options.createCanvas);var F;M&&U&&p.indexOf("ww")!==-1?F=g.worker_offscreen_canvas_support():F=Promise.resolve(!1),F=F.then(function(q){S=q});var N=g.cib_can_use_region().then(function(q){R=q});return this.__initPromise=Promise.all([I,L,F,N]).then(function(){return s}),this.__initPromise},P.prototype.__invokeResize=function(s,p){var h=this;return p.__mathCache=p.__mathCache||{},Promise.resolve().then(function(){return h.features.ww?new Promise(function(C,I){var L=h.__workersPool.acquire();p.cancelToken&&p.cancelToken.catch(function(N){return I(N)}),L.value.onmessage=function(N){L.release(),N.data.err?I(N.data.err):C(N.data)};var F=[];s.src&&F.push(s.src.buffer),s.srcBitmap&&F.push(s.srcBitmap),L.value.postMessage({opts:s,features:h.__requested_features,preload:{wasm_nodule:h.__mathlib.__}},F)}):{data:h.__mathlib.resizeAndUnsharp(s,p.__mathCache)}})},P.prototype.__extractTileData=function(s,p,h,C,I){if(this.features.ww&&S&&(g.isCanvas(p)||R))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(C.srcImageBitmap||p,s.x,s.y,s.width,s.height).then(function(N){return I.srcBitmap=N,I});if(g.isCanvas(p))return C.srcCtx||(C.srcCtx=p.getContext("2d")),this.debug("Get tile pixel data"),I.src=C.srcCtx.getImageData(s.x,s.y,s.width,s.height).data,I;this.debug("Draw tile imageBitmap/image to temporary canvas");var L=this.options.createCanvas(s.width,s.height),F=L.getContext("2d");return F.globalCompositeOperation="copy",F.drawImage(C.srcImageBitmap||p,s.x,s.y,s.width,s.height,0,0,s.width,s.height),this.debug("Get tile pixel data"),I.src=F.getImageData(0,0,s.width,s.height).data,L.width=L.height=0,I},P.prototype.__landTileData=function(s,p,h){var C;if(this.debug("Convert raw rgba tile result to ImageData"),p.bitmap)return h.toCtx.drawImage(p.bitmap,s.toX,s.toY),null;if(U)C=new ImageData(new Uint8ClampedArray(p.data),s.toWidth,s.toHeight);else if(C=h.toCtx.createImageData(s.toWidth,s.toHeight),C.data.set)C.data.set(p.data);else for(var I=C.data.length-1;I>=0;I--)C.data[I]=p.data[I];return this.debug("Draw tile"),D?h.toCtx.putImageData(C,s.toX,s.toY,s.toInnerX-s.toX,s.toInnerY-s.toY,s.toInnerWidth+1e-5,s.toInnerHeight+1e-5):h.toCtx.putImageData(C,s.toX,s.toY,s.toInnerX-s.toX,s.toInnerY-s.toY,s.toInnerWidth,s.toInnerHeight),null},P.prototype.__tileAndResize=function(s,p,h){var C=this,I={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},L=function(N){return C.__limit(function(){if(h.canceled)return h.cancelToken;var q={width:N.width,height:N.height,toWidth:N.toWidth,toHeight:N.toHeight,scaleX:N.scaleX,scaleY:N.scaleY,offsetX:N.offsetX,offsetY:N.offsetY,filter:h.filter,unsharpAmount:h.unsharpAmount,unsharpRadius:h.unsharpRadius,unsharpThreshold:h.unsharpThreshold};return C.debug("Invoke resize math"),Promise.resolve(q).then(function(z){return C.__extractTileData(N,s,h,I,z)}).then(function(z){return C.debug("Invoke resize math"),C.__invokeResize(z,h)}).then(function(z){return h.canceled?h.cancelToken:(I.srcImageData=null,C.__landTileData(N,z,I))})})};return Promise.resolve().then(function(){if(I.toCtx=p.getContext("2d"),g.isCanvas(s))return null;if(g.isImageBitmap(s))return I.srcImageBitmap=s,I.isImageBitmapReused=!0,null;if(g.isImage(s))return M?(C.debug("Decode image via createImageBitmap"),createImageBitmap(s).then(function(F){I.srcImageBitmap=F}).catch(function(F){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(h.canceled)return h.cancelToken;C.debug("Calculate tiles");var F=w({width:h.width,height:h.height,srcTileSize:C.options.tile,toWidth:h.toWidth,toHeight:h.toHeight,destTileBorder:h.__destTileBorder}),N=F.map(function(z){return L(z)});function q(z){z.srcImageBitmap&&(z.isImageBitmapReused||z.srcImageBitmap.close(),z.srcImageBitmap=null)}return C.debug("Process tiles"),Promise.all(N).then(function(){return C.debug("Finished!"),q(I),p},function(z){throw q(I),z})})},P.prototype.__processStages=function(s,p,h,C){var I=this;if(C.canceled)return C.cancelToken;var L=s.shift(),F=d(L,2),N=F[0],q=F[1],z=s.length===0,$;z||E.q2f.indexOf(C.filter)<0?$=C.filter:C.filter==="box"?$="box":$="hamming",C=r({},C,{toWidth:N,toHeight:q,filter:$});var X;return z||(X=this.options.createCanvas(N,q)),this.__tileAndResize(p,z?h:X,C).then(function(){return z?h:(C.width=N,C.height=q,I.__processStages(s,X,h,C))}).then(function(he){return X&&(X.width=X.height=0),he})},P.prototype.__resizeViaCreateImageBitmap=function(s,p,h){var C=this,I=p.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(s,{resizeWidth:h.toWidth,resizeHeight:h.toHeight,resizeQuality:g.cib_quality_name(E.f2q[h.filter])}).then(function(L){if(h.canceled)return h.cancelToken;if(!h.unsharpAmount)return I.drawImage(L,0,0),L.close(),I=null,C.debug("Finished!"),p;C.debug("Unsharp result");var F=C.options.createCanvas(h.toWidth,h.toHeight),N=F.getContext("2d");N.drawImage(L,0,0),L.close();var q=N.getImageData(0,0,h.toWidth,h.toHeight);return C.__mathlib.unsharp_mask(q.data,h.toWidth,h.toHeight,h.unsharpAmount,h.unsharpRadius,h.unsharpThreshold),I.putImageData(q,0,0),F.width=F.height=0,q=N=F=I=null,C.debug("Finished!"),p})},P.prototype.resize=function(s,p,h){var C=this;this.debug("Start resize...");var I=r({},y);if(isNaN(h)?h&&(I=r(I,h)):I=r(I,{quality:h}),I.toWidth=p.width,I.toHeight=p.height,I.width=s.naturalWidth||s.width,I.height=s.naturalHeight||s.height,Object.prototype.hasOwnProperty.call(I,"quality")){if(I.quality<0||I.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(I.quality));I.filter=E.q2f[I.quality]}if(p.width===0||p.height===0)return Promise.reject(new Error("Invalid output size: ".concat(p.width,"x").concat(p.height)));I.unsharpRadius>2&&(I.unsharpRadius=2),I.canceled=!1,I.cancelToken&&(I.cancelToken=I.cancelToken.then(function(F){throw I.canceled=!0,F},function(F){throw I.canceled=!0,F}));var L=3;return I.__destTileBorder=Math.ceil(Math.max(L,2.5*I.unsharpRadius|0)),this.init().then(function(){if(I.canceled)return I.cancelToken;if(C.features.cib){if(E.q2f.indexOf(I.filter)>=0)return C.__resizeViaCreateImageBitmap(s,p,I);C.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!k){var F=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw F.code="ERR_GET_IMAGE_DATA",F}var N=v(I.width,I.height,I.toWidth,I.toHeight,C.options.tile,I.__destTileBorder);return C.__processStages(N,s,p,I)})},P.prototype.resizeBuffer=function(s){var p=this,h=r({},y,s);if(Object.prototype.hasOwnProperty.call(h,"quality")){if(h.quality<0||h.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(h.quality));h.filter=E.q2f[h.quality]}return this.init().then(function(){return p.__mathlib.resizeAndUnsharp(h)})},P.prototype.toBlob=function(s,p,h){return p=p||"image/png",new Promise(function(C){if(s.toBlob){s.toBlob(function(q){return C(q)},p,h);return}if(s.convertToBlob){C(s.convertToBlob({type:p,quality:h}));return}for(var I=atob(s.toDataURL(p,h).split(",")[1]),L=I.length,F=new Uint8Array(L),N=0;N<L;N++)F[N]=I.charCodeAt(N);C(new Blob([F],{type:p}))})},P.prototype.debug=function(){},B.exports=P},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})})(fe);var _e=fe.exports;const be=de(_e),Be={class:"hello"},Ee={key:0},Ce={key:1,class:"ui divider"},Qe={key:2},ye={key:3},ke={key:4},Ue={class:"ui grid container"},De={key:0,class:"ui stackable two column row"},xe={class:"ten wide column"},Me={class:"ui fluid card container"},Re={key:0,class:"filler"},Fe={class:"six wide column"},Ge={key:0},Ne={key:1},Le={key:1,class:"filler"},Se={key:5,class:"ui container"},Pe={key:0,class:"ui warning message"},He={key:0},Oe={class:"ui form error warning success",id:"main-form"},je={class:"field"},qe={class:"ui center aligned segment"},Te=["src"],We={class:"field"},Ye={key:0,class:"ui error message"},ze={key:1,class:"ui warning message"},Ve={class:"field"},Xe={class:"two fields"},Je={class:"field"},Ze={key:0},Ke=["href"],$e=["src","title","alt"],et={class:"field"},tt={key:0},rt=["href"],it=["src","title","alt"],nt={class:"two fields"},ot={class:"field"},at={class:"field"},st={class:"field"},At=["value"],lt={class:"field"},ut=["value"],ft={key:0},ht={key:1,class:"ui warning message"},gt={key:2,class:"ui error message"},dt={class:"field"},ct={key:0},mt={style:{"margin-left":"15px"}},pt={key:1},vt={class:"three fields"},It={class:"field"},wt={class:"field"},_t={class:"field"},bt={class:"field"},Bt={class:"field"},Et={key:0,class:"ui warning message"},Ct={key:1,class:"ui success message"},Qt={key:3,class:"warning"},yt={key:4,class:"warning"},kt={key:1},Ut={class:"ui vertical buttons"},Dt={key:0},xt={key:1};function Mt(_,e,m,B,o,d){const f=le("router-link"),n=le("card");return H(),O("div",Be,[m.isInApp?(H(),O("p",Ee,"您正在 App 內使用，故無法登入，請使用一般瀏覽器登入。")):j("",!0),W(l("p",null,[e[24]||(e[24]=Y("請先")),ie(f,{target:"_blank",to:"/privacy-policy"},{default:ne(()=>e[23]||(e[23]=[Y("隱私權政策")])),_:1}),e[25]||(e[25]=Y("請詳閱並同意"))],512),[[K,o.isNew]]),o.isNew?(H(),O("div",Ce)):j("",!0),o.isNew?(H(),O("br",Qe)):j("",!0),o.isNew?(H(),O("br",ye)):j("",!0),o.isNew?(H(),O("br",ke)):j("",!0),l("div",Ue,[o.editing?j("",!0):(H(),O("div",De,[W(l("div",xe,[W(l("div",Me,[ie(n,{h:o.root,full:!0,onLocate:d.locate,onLoginGoogle:d.loginGoogle,uid:m.uid},null,8,["h","onLocate","onLoginGoogle","uid"])],512),[[K,!o.isNew&&!o.editing]])],512),[[K,!o.isNew]]),o.isNew?(H(),O("div",Re)):j("",!0),l("div",Fe,[W(l("div",{class:"ui massive blue button",onClick:e[0]||(e[0]=(...t)=>d.startEdit&&d.startEdit(...t))},[e[26]||(e[26]=l("i",{class:"edit icon"},null,-1)),e[27]||(e[27]=Y("我要")),o.isNew?(H(),O("span",Ge,"升旗")):(H(),O("span",Ne,"更新資料"))],512),[[K,m.uid&&!o.editing]])]),o.isNew?(H(),O("div",Le)):j("",!0)]))]),o.editing?(H(),O("div",Se,[d.longTimeNoSee()>.25&&!o.isNew?(H(),O("div",Pe,[e[28]||(e[28]=l("div",{class:"header"},"您的資料已經一年未更新",-1)),d.longTimeNoSee()>.25?(H(),O("span",He,"目前已被系統隱藏，請立即更新即可恢復顯示。")):j("",!0)])):j("",!0),W(l("form",Oe,[e[63]||(e[63]=l("h2",{class:"ui header"},"填寫資料",-1)),e[64]||(e[64]=l("div",{class:"sub header"},[Y("請填寫以下資料"),l("br"),Y("標示"),l("i",{class:"red star"}),Y("為必填欄位")],-1)),e[65]||(e[65]=l("h4",{class:"ui dividing header"},"基本資料",-1)),l("div",je,[e[30]||(e[30]=l("label",null,"大頭貼",-1)),l("div",qe,[l("img",{class:"ui centered medium round image",src:o.root.photoURL||"https://we.alearn.org.tw/logo-new.png",style:{"max-width":"200px"}},null,8,Te),l("input",{type:"file",accept:"image/*",ref:"photoInput",style:{display:"none"},onChange:e[1]||(e[1]=(...t)=>d.handlePhotoUpload&&d.handlePhotoUpload(...t))},null,544),l("div",{class:"ui basic button",onClick:e[2]||(e[2]=t=>_.$refs.photoInput.click())},e[29]||(e[29]=[l("i",{class:"upload icon"},null,-1),Y("上傳新大頭貼")]))])]),l("div",We,[e[31]||(e[31]=l("label",{class:"required"},"稱呼",-1)),W(l("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>o.root.name=t),placeholder:"您希望別人如何稱呼您"},null,512),[[V,o.root.name]])]),l("div",{class:oe(["field",{error:o.root.address&&(o.root.latlngColumn=="undefined,undefined"||o.root.latlngColumn=="36.778261,-119.4179324")}])},[e[34]||(e[34]=l("label",{class:"required"},"概略地址",-1)),W(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.root.address=t),placeholder:"請輸入地址"},null,512),[[V,o.root.address,void 0,{trim:!0}]]),o.root.address&&(o.root.latlngColumn=="undefined,undefined"||o.root.latlngColumn=="36.778261,-119.4179324")?(H(),O("div",Ye,e[32]||(e[32]=[l("div",{class:"header"},"地址格式錯誤",-1),l("p",null,"請確認地址格式是否正確。",-1)]))):j("",!0),d.tooDetail(o.root.address)?(H(),O("div",ze,e[33]||(e[33]=[l("div",{class:"header"},"地址過於詳細",-1),l("p",null,"請提供更詳細的地址。",-1)]))):j("",!0)],2),e[66]||(e[66]=l("h4",{class:"ui header"},[Y("地圖位置"),l("div",{class:"sub header"},"請在地圖上選擇位置")],-1)),e[67]||(e[67]=l("div",{id:"map",style:{height:"300px"}},null,-1)),e[68]||(e[68]=l("div",{class:"ui divider"},null,-1)),l("div",Ve,[e[37]||(e[37]=l("label",null,"網站網址",-1)),l("div",Xe,[l("div",Je,[W(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.root.site=t),placeholder:"請輸入個人網站網址"},null,512),[[V,o.root.site]]),o.root.site?(H(),O("span",Ze,[l("a",{href:o.root.site,target:"_blank"},[l("img",{src:"https://www.google.com/s2/favicons?domain="+o.root.site,title:o.root.site,alt:o.root.site},null,8,$e),e[35]||(e[35]=Y("測試連結"))],8,Ke)])):j("",!0)]),l("div",et,[W(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.root.site2=t),placeholder:"請輸入社群網站網址"},null,512),[[V,o.root.site2]]),o.root.site2?(H(),O("span",tt,[l("a",{href:o.root.site2,target:"_blank"},[l("img",{src:"https://www.google.com/s2/favicons?domain="+o.root.site2,title:o.root.site2,alt:o.root.site2},null,8,it),e[36]||(e[36]=Y("測連結"))],8,rt)])):j("",!0)])])]),l("div",nt,[l("div",ot,[e[38]||(e[38]=l("label",{class:"required"},"聯絡方式",-1)),W(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.root.connect_me=t),placeholder:"請輸入聯絡方式"},null,512),[[V,o.root.connect_me]])]),l("div",at,[e[39]||(e[39]=l("label",null,"空閒時間",-1)),W(l("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=t=>o.root.freetime=t),placeholder:"請輸入空閒時間"},null,512),[[V,o.root.freetime]])])]),e[69]||(e[69]=l("h4",{class:"ui dividing header"},"角色與類型",-1)),l("div",st,[e[41]||(e[41]=l("label",null,"角色",-1)),W(l("select",{class:"selectpicker","onUpdate:modelValue":e[9]||(e[9]=t=>o.root.learner_role=t)},[e[40]||(e[40]=l("option",{value:""},"-- 請選擇角色 --",-1)),(H(),O(ae,null,se(["準會員","一般會員","理事","監事","常務理事","常務監事","理事長","其他"],t=>l("option",{value:t},J(t),9,At)),64))],512),[[Ae,o.root.learner_role]])]),l("div",lt,[e[43]||(e[43]=l("label",null,"類型",-1)),W(l("select",{class:"selectpicker","onUpdate:modelValue":e[10]||(e[10]=t=>o.root.learner_type=t)},[e[42]||(e[42]=l("option",{value:""},"-- 請選擇類型 --",-1)),(H(),O(ae,null,se(["準會員","一般會員","志工","教師","其他"],t=>l("option",{value:t},J(t),9,ut)),64))],512),[[Ae,o.root.learner_type]])]),l("div",{class:oe(["field",{error:_.badAge(o.root.learner_birth),warning:!o.root.learner_birth}])},[e[44]||(e[44]=l("label",{class:"required"},"出生年份",-1)),W(l("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=t=>o.root.learner_birth=t),placeholder:"請輸入出生年份"},null,512),[[V,o.root.learner_birth]])],2),o.root.learner_birth?(H(),O("span",ft,"您已經 "+J(_.toAge(o.root.learner_birth))+" 歲",1)):j("",!0),o.root.learner_birth?j("",!0):(H(),O("div",ht,e[45]||(e[45]=[l("div",{class:"header"},"出生年份未填寫",-1),l("p",null,"請填寫出生年份。",-1)]))),_.badAge(o.root.learner_birth)?(H(),O("div",gt,e[46]||(e[46]=[l("div",{class:"header"},"出生年份格式錯誤",-1),l("p",null,"請確認出生年份格式是否正確。",-1)]))):j("",!0),l("div",dt,[e[59]||(e[59]=l("label",null,"最大孩子出生年份",-1)),l("span",null,[W(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>o.root.child_birth=t),type:"text",placeholder:"請輸入子女出生年份"},null,512),[[V,o.root.child_birth]]),e[50]||(e[50]=l("br",null,null,-1)),o.root.child_birth?(H(),O("span",ct,"您的孩子已經 "+J(_.toAge(o.root.child_birth))+" 歲",1)):j("",!0),e[51]||(e[51]=l("div",{class:"ui divider"},null,-1)),l("span",mt,[e[47]||(e[47]=Y("最小孩子出生年份")),e[48]||(e[48]=l("br",null,null,-1)),W(l("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>o.root.child_birth2=t),type:"text",placeholder:"請輸入子女出生年份"},null,512),[[V,o.root.child_birth2]]),e[49]||(e[49]=l("br",null,null,-1))]),o.root.child_birth2?(H(),O("span",pt,"您的子女出生於 "+J(_.toAge(o.root.child_birth2))+" 歲至 "+J(_.toAge(o.root.child_birth))+" 歲",1)):j("",!0)]),e[60]||(e[60]=l("div",{class:"ui divider"},null,-1)),l("div",vt,[l("div",It,[e[52]||(e[52]=l("label",{class:"required"},"興趣",-1)),W(l("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>o.root.learner_habit=t),placeholder:"請輸入興趣"},null,512),[[V,o.root.learner_habit]])]),l("div",wt,[e[53]||(e[53]=l("label",{class:"required"},"分享",-1)),W(l("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>o.root.share=t),placeholder:"請輸入分享"},null,512),[[V,o.root.share]])]),l("div",_t,[e[54]||(e[54]=l("label",null,"尋找",-1)),W(l("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>o.root.ask=t),placeholder:"請輸入詢問"},null,512),[[V,o.root.ask]])]),l("div",bt,[e[55]||(e[55]=l("label",null,"可支付",-1)),W(l("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>o.root.price=t),placeholder:"請輸入可支付"},null,512),[[V,o.root.price]])])]),l("div",Bt,[e[56]||(e[56]=l("label",{class:"required"},"自我介紹",-1)),W(l("textarea",{id:"note","onUpdate:modelValue":e[18]||(e[18]=t=>o.root.note=t),rows:"5",cols:"30",placeholder:"請輸入自我介紹"},null,512),[[V,o.root.note]])]),o.root.note&&o.root.note.length<20?(H(),O("div",Et,e[57]||(e[57]=[l("div",{class:"header"},"自我介紹過短",-1),l("p",null,"請至少輸入 20 個字。",-1)]))):j("",!0),o.root.note&&o.root.note.length>=20?(H(),O("div",Ct,e[58]||(e[58]=[l("div",{class:"header"},"自我介紹已達標準",-1),l("p",null,"自我介紹已達到 20 個字以上。",-1)]))):j("",!0)]),!m.emailVerified&&o.root.login_method==="email"?(H(),O("div",Qt,[e[61]||(e[61]=Y("note: 您的Email尚未驗證")),l("button",{class:"ui button",onClick:e[19]||(e[19]=t=>_.$emit("resendVerificationEmail"))},"按此重發驗證信")])):j("",!0),d.isValid(o.root)?j("",!0):(H(),O("div",yt,e[62]||(e[62]=[Y("note: 資料不完整"),l("i",{class:"red star"},null,-1),Y("請確認所有欄位是否填寫完整。")])))],512),[[K,o.editing]]),o.isNew?(H(),O("p",kt,[W(l("input",{class:"ui checkbox",type:"checkbox","onUpdate:modelValue":e[20]||(e[20]=t=>o.agree=t)},null,512),[[ce,o.agree]]),e[71]||(e[71]=Y("我已閱讀並同意")),ie(f,{target:"_blank",to:"/privacy-policy"},{default:ne(()=>e[70]||(e[70]=[Y("隱私權政策")])),_:1})])):j("",!0),l("div",Ut,[l("button",{class:oe(["ui large primary button",{disabled:!d.isValid(o.root)||!m.emailVerified&&o.root.login_method==="email"}]),onClick:e[21]||(e[21]=(...t)=>d.updateFlag&&d.updateFlag(...t))},[o.isNew?(H(),O("span",Dt,e[72]||(e[72]=[l("i",{class:"flag icon"},null,-1),Y("升旗")]))):(H(),O("span",xt,e[73]||(e[73]=[l("i",{class:"flag icon"},null,-1),Y("更新資料")])))],2),o.isNew?j("",!0):(H(),me(f,{key:0,class:"ui large basic primary button",to:"/flag/"+m.uid},{default:ne(()=>e[74]||(e[74]=[l("i",{class:"user icon"},null,-1),Y("檢查旗幟"),l("i",{class:"chevron right icon"},null,-1)])),_:1},8,["to"])),o.isNew?j("",!0):(H(),O("div",{key:1,class:"ui large red button",onClick:e[22]||(e[22]=(...t)=>d.confirmDelete&&d.confirmDelete(...t))},e[75]||(e[75]=[l("i",{class:"delete icon"},null,-1),Y("刪除旗幟")])))]),e[76]||(e[76]=l("br",null,null,-1)),e[77]||(e[77]=l("br",null,null,-1)),e[78]||(e[78]=l("br",null,null,-1)),e[79]||(e[79]=l("br",null,null,-1))])):j("",!0)])}const Rt={name:"MyFlag",props:["uid","user","emailVerified","email","mySearch","provider","photoURL","isInApp"],components:{Card:ge},mixins:[we],metaInfo:{title:"個人資料"},data(){return{agree:!1,root:{latlngColumn:"23.5330,121.0654"},local:{},map:null,marker:null,isNew:!0,editing:!1}},emits:["loginGoogle","locate"],watch:{uid(_){_&&this.fetchUserData()}},mounted(){this.uid?this.fetchUserData():console.log("請先登入")},methods:{isValid(){return!this.root.note||this.root.note.length<20?!1:[this.root.name,this.root.address,this.root.connect_me,this.root.learner_birth,this.root.learner_habit,this.root.share,this.root.note].every(e=>e&&e.trim()!=="")},startEdit(){this.editing=!0,Z.Icon.Default.imagePath="//cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/",setTimeout(this.initMap,500),setTimeout(this.setMapAndMarker,1e3),this.root.email||this.fetchUserData()},initMap(){let e=[23.533,121.0654];if(typeof this.root.latlngColumn=="string"){const m=this.root.latlngColumn.split(",");if(m.length===2){const B=parseFloat(m[0]),o=parseFloat(m[1]);!isNaN(B)&&!isNaN(o)&&(e=[B,o])}}this.map=Z.map("map").setView(e,7),Z.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),Z.Icon.Default.imagePath="//cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/",this.marker=Z.marker(this.map.getCenter(),{draggable:!0}).addTo(this.map),this.marker.on("dragend",()=>{const{lat:m,lng:B}=this.marker.getLatLng();this.map.setView({lat:m,lng:B}),this.root.latlngColumn=`${m.toFixed(5)},${B.toFixed(5)}`,this.$forceUpdate()})},fetchUserData(){const _=ee(te,"users/"+this.uid);ve(_).then(e=>{if(e.exists()){this.isNew=!1,this.root=e.val();let m=[...this.user&&this.user.providerData||[]];m.length===0&&(m=[{displayName:(this.root.email||"").split("@")[0]||"Unknown",email:this.root.email,photoURL:this.root.photoURL||"https://we.alearn.org.tw/logo-new.png"}]),this.root.email=this.root.email||this.email,this.root.connect_me=this.root.connect_me||this.email,this.root.name=this.root.name||this.user.name||m[0].displayName||"新朋友",this.root.photoURL=this.root.photoURL||decodeURI(this.user.photoURL)||"https://we.alearn.org.tw/logo-new.png",this.root.login_method=this.root.login_method||"google"}else{console.log("No data available for user: "+this.uid);let m=[...this.user&&this.user.providerData||[]];m.length===0&&(m=[{displayName:(this.root.email||"").split("@")[0]||"新朋友",email:this.root.email||"",photoURL:this.root.photoURL||"https://we.alearn.org.tw/logo-new.png",login_method:"email"}]),this.root={name:m[0].displayName,uid:this.uid,email:this.email,connect_me:this.email,photoURL:this.root.photoURL,latlngColumn:"23.5330,121.0654",note:"",login_method:this.root.login_method||"google"},this.isNew=!0}}).catch(e=>{console.error(e),console.log("No data available for user: "+this.uid),console.log(this.user);let m=[...this.user&&this.user.providerData||[]];m.length===0&&(m=[{displayName:(this.root.email||"").split("@")[0]||"新朋友",email:this.root.email||"",photoURL:this.root.photoURL||"https://we.alearn.org.tw/logo-new.png"}]),this.root={name:m[0].displayName,uid:this.uid,email:this.email,connect_me:this.email,photoURL:this.root.photoURL,latlngColumn:"23.5330,121.0654",note:"",login_method:this.root.login_method||"google"},this.isNew=!0})},setMapAndMarker(){if(this.map&&this.marker){let e=[23.533,121.0654];if(this.root&&typeof this.root.latlngColumn=="string"){const B=this.root.latlngColumn.split(",");if(B.length===2){const o=parseFloat(B[0]),d=parseFloat(B[1]);!isNaN(o)&&!isNaN(d)&&(e=[o,d])}}const m=Z.latLng(e[0],e[1]);this.map.setView(m,7),this.marker.setLatLng(m)}},longTimeNoSee(){return this.root.lastUpdate?(new Date().getTime()-this.root.lastUpdate)/1e3/3600/24/365.25:1/0},tooDetail:function(_){return _?!!_.match(/(號|樓|F|f)/):!1},updateFlag:function(){if(this.root.email=this.email||"",this.root.uid=this.uid||"",this.root.photoURL=this.root.photoURL||this.photoURL||"",this.root.lastUpdate=new Date().getTime(),!this.emailVerified&&this.root.login_method==="email"&&alert("Email尚未驗證"),!this.isNew)this.isNew=!1,this.editing=!1,ue(ee(te,"users/"+this.uid),this.root).then(alert("更新成功"));else if(this.agree)console.log("new2"),this.isNew=!1,this.editing=!1,ue(ee(te,"users/"+this.uid),this.root).then(alert("升旗成功"));else{window.alert("請先閱讀並同意隱私權政策");return}this.$emit("locate",this.root,!1)},confirmDelete(){window.confirm("確認要刪除旗幟嗎？此動作無法復原。")&&this.deleteFlag()},deleteFlag(){const _=this.uid;Ie(ee(te,"users/"+_)).then(()=>{alert("刪除成功"),this.root={},this.$emit("logout")}).catch(e=>{alert("刪除失敗："+e.message)})},loginFB:function(){this.$emit("loginFB")},locate:function(_,e){this.$emit("locate",_,e)},loginGoogle:function(){this.$emit("loginGoogle")},async handlePhotoUpload(_){const e=_.target.files[0];if(!e)return;if(!["image/jpeg","image/png","image/gif"].includes(e.type)){alert("請上傳 JPG、PNG 或 GIF 格式的圖片");return}if(e.size>5*1024*1024){alert("圖片大小不能超過 5MB");return}try{const B=document.createElement("canvas"),o=new Image;await new Promise((a,b)=>{o.onload=()=>a(),o.onerror=()=>b(new Error("圖片載入失敗")),o.src=URL.createObjectURL(e)});let f=600,n=o.height*f/o.width;n>800&&(n=800,f=o.width*n/o.height),B.width=f,B.height=n;const t=new be({features:["js","wasm","cib"],idle:2e3}),i=await t.resize(o,B,{alpha:!0,unsharpAmount:160,unsharpRadius:.8,unsharpThreshold:1,quality:3}),A=await t.toBlob(i,"image/jpeg",.92),r=new FileReader;r.onloadend=()=>{this.root.photoURL=r.result},r.readAsDataURL(A),URL.revokeObjectURL(o.src)}catch(B){console.error("圖片處理失敗:",B),alert("圖片處理失敗，請重試")}}}},St=pe(Rt,[["render",Mt],["__scopeId","data-v-2d73f7d9"]]);export{St as default};
