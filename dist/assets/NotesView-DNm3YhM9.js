import{d as O,r as b,c as j,o as B,b as h,e as w,a as E,T as q,ac as $,a4 as A,g as d,h as o,w as G,v as U,t as u,i as I,F as _,j as C,z as W,A as H,ad as J,k as c,m as M,ab as D,a5 as K,_ as P}from"./index-4fv_w86v.js";const Q=O({name:"NotesView",props:{users:{type:Object,required:!1,default:()=>[]},uid:{type:String,required:!1,default:"匿名"}},setup(e){const a={"#ffd700":"解決問題","#ff69b4":"嘗試專案","#4169e1":"資源協助","#21a921":"學習文化","#aa70aa":"貢獻能力"},r=b([]),g=b(null),v=b({content:"",color:"#ffd700",user:"匿名"}),p=b(""),s=b(!1),n=j(()=>g.value?r.value.filter(t=>t.color===g.value):r.value),y=t=>new Date(t).toLocaleDateString("zh-TW",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=async()=>{try{if(!v.value.content.trim()){p.value="請輸入內容";return}s.value=!0;const t={content:v.value.content.trim(),color:v.value.color,timestamp:new Date().toISOString(),likes:0,user:e.users[e.uid].name||"匿名"},i=h(w,"notes"),f=await q(i);await $(f,{id:f.key,...t}),v.value.content="",p.value="",console.log("便利貼新增成功！")}catch(t){console.error("新增便利貼失敗：",t),p.value="新增失敗，請稍後再試"}finally{s.value=!1}},T=async t=>{const i=h(w,`notes/${t.id}`);await $(i,{likes:(t.likes||0)+1})},L=(t,i)=>{t.dataTransfer&&t.dataTransfer.setData("noteId",i.id)},V=t=>{t.preventDefault()},R=async(t,i)=>{if(t.preventDefault(),!t.dataTransfer)return;const f=t.dataTransfer.getData("noteId"),m=i.id,l=r.value.findIndex(k=>k.id===f),N=r.value.findIndex(k=>k.id===m);if(l>-1&&N>-1){const k=r.value[l];r.value[l]=r.value[N],r.value[N]=k}},z=t=>{g.value=t},F=async t=>{try{if(!confirm("確定要刪除這張便利貼嗎？"))return;const i=h(w,`notes/${t.id}`);await A(i),console.log("便利貼刪除成功！")}catch(i){console.error("刪除便利貼失敗：",i),p.value="刪除失敗，請稍後再試"}};return B(()=>{const t=h(w,"notes");E(t,i=>{const f=i.val();f?(r.value=Object.entries(f).map(([m,l])=>({id:m,content:l.content||"",color:l.color||"#ffd700",timestamp:l.timestamp||new Date().toISOString(),likes:l.likes||0,user:l.user||"匿名"})),r.value.sort((m,l)=>new Date(l.timestamp).getTime()-new Date(m.timestamp).getTime())):r.value=[]})}),{notes:r,selectedFilter:g,newNote:v,errorMessage:p,isLoading:s,filteredNotes:n,colorMap:a,formatDate:y,addNote:S,toggleLike:T,dragStart:L,dragEnd:V,drop:R,filterNotes:z,deleteNote:F}}}),X={class:"notes-view"},Y={class:"input-section"},Z={class:"note-input"},x=["disabled"],ee={key:0,class:"error-message"},te={class:"color-selector"},se=["onClick"],oe={class:"tooltip"},ne=["disabled"],ae={key:0},re={key:1},ie={class:"filter-section"},le=["onClick"],de={class:"notes-wall"},ce=["onDragstart","onDrop"],ue={class:"note-content"},fe={class:"note-footer"},ve={class:"note-info"},pe={class:"user"},ge={class:"timestamp"},me={class:"note-actions"},ke=["onClick"],be={class:"like-count"},he=["onClick"],we={key:0,class:"error-message"};function ye(e,a,r,g,v,p){return c(),d("div",X,[a[7]||(a[7]=o("div",{class:"header"},[o("h1",{class:"title"},"數位便利貼牆"),o("p",{class:"subtitle"},"分享你的想法、需求與專案")],-1)),o("div",Y,[o("div",Z,[G(o("textarea",{"onUpdate:modelValue":a[0]||(a[0]=s=>e.newNote.content=s),placeholder:"分享你的想法...",rows:"3",disabled:e.isLoading},null,8,x),[[U,e.newNote.content]]),e.errorMessage?(c(),d("div",ee,u(e.errorMessage),1)):I("",!0),o("div",te,[(c(!0),d(_,null,C(e.colorMap,(s,n)=>(c(),d("div",{class:M(["color-option",{active:e.newNote.color===n}]),key:n,style:D({backgroundColor:n}),onClick:y=>e.newNote.color=n},[o("span",oe,u(s),1)],14,se))),128))]),o("button",{class:"submit-btn",onClick:a[1]||(a[1]=(...s)=>e.addNote&&e.addNote(...s)),disabled:e.isLoading},[e.isLoading?(c(),d("span",re,"新增中...")):(c(),d("span",ae,"新增便利貼"))],8,ne)])]),o("div",ie,[(c(!0),d(_,null,C(e.colorMap,(s,n)=>(c(),d("button",{class:M(["filter-btn",{active:e.selectedFilter===n}]),key:n,style:D({backgroundColor:n}),onClick:y=>e.filterNotes(n)},u(s),15,le))),128)),o("button",{class:"filter-btn all",onClick:a[2]||(a[2]=s=>e.filterNotes(null))},"全部")]),o("div",de,[W(J,{class:"notes-grid",name:"note-list",tag:"div"},{default:H(()=>[(c(!0),d(_,null,C(e.filteredNotes,s=>(c(),d("div",{class:"note",key:s.id,style:D({backgroundColor:s.color}),draggable:"true",onDragstart:n=>e.dragStart(n,s),onDragend:a[3]||(a[3]=n=>e.dragEnd(n)),onDragover:a[4]||(a[4]=K(()=>{},["prevent"])),onDrop:n=>e.drop(n,s)},[o("div",ue,u(s.content),1),o("div",fe,[o("div",ve,[o("span",pe,u(s.user),1),o("span",ge,u(e.formatDate(s.timestamp)),1)]),o("div",me,[o("button",{class:"like-btn",onClick:n=>e.toggleLike(s)},[a[5]||(a[5]=o("span",{class:"like-icon"},"❤️",-1)),o("span",be,u(s.likes),1)],8,ke)])]),o("button",{class:"delete-btn",title:"刪除",onClick:n=>e.deleteNote(s)},a[6]||(a[6]=[o("span",{class:"delete-icon"},"🗑️",-1)]),8,he)],44,ce))),128))]),_:1})]),e.errorMessage?(c(),d("div",we,u(e.errorMessage),1)):I("",!0)])}const _e=P(Q,[["render",ye],["__scopeId","data-v-4aaa0788"]]);export{_e as default};
