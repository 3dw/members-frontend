import{d as B,r as y,c as T,o as I,a as M,n as k,s as D,b,e as d,f as a,g as h,F as $,h as L,w as S,v as V,i as l,t as v,_ as C}from"./index-BpPOmUYp.js";const N=B({props:{uid:{required:!1,default:""},users:{required:!1,default:()=>({})}},setup(t,{emit:e}){const o=y([{author:"AliceS",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"BobS",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-20 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-20 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-29 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-29 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."}]),r=y(""),p=T(()=>[...o.value].sort((n,u)=>{const i=new Date(n.date);return new Date(u.date).getTime()-i.getTime()})),m=()=>{console.log(r.value),o.value.push({author:t.users[t.uid].name||"匿名",uid:t.uid||"123",date:new Date().toISOString(),text:r.value}),r.value="",D(b,o.value).then(()=>{console.log("留言成功")})},s=()=>{e("toggleLogin")},g=n=>{const u=new Date,i=new Date(n);if(isNaN(i.getTime()))return"無效日期";const c=u.getTime()-i.getTime(),f=Math.floor(c/1e3),w=Math.floor(c/(1e3*60)),A=Math.floor(c/(1e3*60*60)),x=Math.floor(c/(1e3*60*60*24));return f<60?f===0?"剛剛":`${f} 秒前`:w<60?`${w} 分鐘前`:A<24?`${A} 小時前`:`${x} 天前`};return I(()=>{console.log("mounted"),M(b,n=>{const u=n.val();console.log(u),o.value=u.map(i=>({author:i.author,uid:i.uid,date:i.date,text:i.text}))}),setInterval(async()=>{console.log("tick"),await k(),o.value=[...o.value]},60*1e3)}),{messages:o,newMessage:r,addMessage:m,parseDate:g,toggleLogin:s,sortedMessages:p}}}),R={class:"ui container two column stackable grid"},U={key:0,class:"column"},q={class:"ui segment"},F={key:1,class:"ui comments flex-column column"},_={class:"content"},E=["src"],H={class:"author"},O={class:"metadata"},j={class:"date"},z={class:"text"},G={key:2,class:"ui form reply column"},J={class:"field"};function K(t,e,o,r,p,m){return l(),d("div",R,[t.uid?h("",!0):(l(),d("div",U,[a("div",q,[e[3]||(e[3]=a("div",{class:"ui header"},"留言板",-1)),e[4]||(e[4]=a("div",{class:"ui description"},"請先登入才能留言",-1)),e[5]||(e[5]=a("div",{class:"ui divider"},null,-1)),a("button",{class:"ui large green basic button",onClick:e[0]||(e[0]=(...s)=>t.toggleLogin&&t.toggleLogin(...s))},"登入")])])),t.uid?(l(),d("div",F,[(l(!0),d($,null,L(t.sortedMessages,(s,g)=>(l(),d("div",{class:"comment",key:g},[a("div",_,[t.users&&t.users[s.uid]&&t.users[s.uid].photoURL?(l(),d("img",{key:0,class:"ui avatar image",src:t.users[s.uid].photoURL},null,8,E)):h("",!0),a("div",H,v(s.author),1),a("div",O,[a("div",j,v(t.parseDate(s.date)),1)]),a("div",z,v(s.text),1)])]))),128))])):h("",!0),t.uid?(l(),d("div",G,[e[7]||(e[7]=a("div",{class:"ui divider thin-only"},null,-1)),a("div",J,[e[6]||(e[6]=a("label",null,"輸入留言",-1)),S(a("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.newMessage=s)},null,512),[[V,t.newMessage]])]),a("div",{class:"ui primary submit button",onClick:e[2]||(e[2]=(...s)=>t.addMessage&&t.addMessage(...s))},"留言")])):h("",!0)])}const Q=C(N,[["render",K],["__scopeId","data-v-baae2c85"]]);export{Q as default};
