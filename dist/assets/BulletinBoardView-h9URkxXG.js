import{d as C,r as T,c as _,o as $,a as L,n as S,s as M,b,e as u,f as a,g as v,F as m,h as x,w as U,v as V,i as c,t as g,j as N,_ as O}from"./index-D56AHNJN.js";const q=C({props:{uid:{required:!1,default:""},users:{required:!1,default:()=>({})}},setup(t,{emit:n}){const d=T([{author:"AliceS",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"BobS",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-20 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-20 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-29 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-29 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."},{author:"Alice",uid:"123",date:"2025-03-18 10:00:00",text:"This is a great post!"},{author:"Bob",uid:"456",date:"2025-03-18 10:00:00",text:"I totally agree with Alice."}].map(e=>({...e,reactions:{}}))),f=T(""),p=_(()=>[...d.value].sort((e,i)=>{const s=new Date(e.date);return new Date(i.date).getTime()-s.getTime()})),w=()=>{console.log(f.value),d.value.push({author:t.users[t.uid].name||"匿名",uid:t.uid||"123",date:new Date().toISOString(),text:f.value,reactions:{}}),f.value="",M(b,d.value).then(()=>{console.log("留言成功")})},o=()=>{n("toggleLogin")},y=e=>{const i=new Date,s=new Date(e);if(isNaN(s.getTime()))return"無效日期";const l=i.getTime()-s.getTime(),h=Math.floor(l/1e3),k=Math.floor(l/(1e3*60)),B=Math.floor(l/(1e3*60*60)),D=Math.floor(l/(1e3*60*60*24));return h<60?h===0?"剛剛":`${h} 秒前`:k<60?`${k} 分鐘前`:B<24?`${B} 小時前`:`${D} 天前`},r=(e,i)=>{t.uid&&(e.reactions||(e.reactions={}),e.reactions[i]||(e.reactions[i]={}),e.reactions[i][t.uid]?delete e.reactions[i][t.uid]:e.reactions[i][t.uid]=!0,M(b,d.value).then(()=>{console.log("反應更新成功")}))},A=(e,i)=>{var s,l;return((l=(s=e.reactions)==null?void 0:s[i])==null?void 0:l[t.uid])||!1},I=(e,i)=>{var s;return Object.keys(((s=e.reactions)==null?void 0:s[i])||{}).length},R=(e,i)=>{var s;return(s=e.reactions)!=null&&s[i]?Object.keys(e.reactions[i]).map(l=>{var h;return((h=t.users[l])==null?void 0:h.name)||"匿名用戶"}).join("、"):""};return $(()=>{console.log("mounted"),L(b,e=>{const i=e.val();console.log(i),d.value=i.map(s=>({author:s.author,uid:s.uid,date:s.date,text:s.text,reactions:s.reactions||{}}))}),setInterval(async()=>{console.log("tick"),await S(),d.value=[...d.value]},60*1e3)}),{messages:d,newMessage:f,addMessage:w,parseDate:y,toggleLogin:o,sortedMessages:p,toggleReaction:r,hasReacted:A,getReactionCount:I,getReactionUsers:R}}}),F={class:"ui container two column stackable grid"},z={key:0,class:"column"},E={class:"ui segment"},H={key:1,class:"ui comments flex-column column"},G={class:"content"},J=["src"],K={class:"author"},P={class:"metadata"},Q={class:"date"},W={class:"text"},X={class:"actions"},Y={class:"reaction-buttons"},Z=["onClick"],j={key:0,class:"reaction-tooltip"},tt={class:"emoji"},et={class:"count"},at={key:2,class:"ui form reply column"},ot={class:"field"};function it(t,n,d,f,p,w){return c(),u("div",F,[t.uid?v("",!0):(c(),u("div",z,[a("div",E,[n[3]||(n[3]=a("div",{class:"ui header"},"留言板",-1)),n[4]||(n[4]=a("div",{class:"ui description"},"請先登入才能留言",-1)),n[5]||(n[5]=a("div",{class:"ui divider"},null,-1)),a("button",{class:"ui large green basic button",onClick:n[0]||(n[0]=(...o)=>t.toggleLogin&&t.toggleLogin(...o))},"登入")])])),t.uid?(c(),u("div",H,[(c(!0),u(m,null,x(t.sortedMessages,(o,y)=>(c(),u("div",{class:"comment",key:y},[a("div",G,[t.users&&t.users[o.uid]&&t.users[o.uid].photoURL?(c(),u("img",{key:0,class:"ui avatar image",src:t.users[o.uid].photoURL},null,8,J)):v("",!0),a("div",K,g(o.author),1),a("div",P,[a("div",Q,g(t.parseDate(o.date)),1)]),a("div",W,g(o.text),1),a("div",X,[a("div",Y,[(c(),u(m,null,x(["👍","❤️","🙏","🫡","❤️‍🔥","😢"],r=>a("button",{class:N(["reaction-btn",{active:t.hasReacted(o,r)}]),key:r,onClick:A=>t.toggleReaction(o,r)},[t.getReactionCount(o,r)>0?(c(),u("div",j,g(t.getReactionUsers(o,r)),1)):v("",!0),a("span",tt,g(r),1),a("span",et,g(t.getReactionCount(o,r)),1)],10,Z)),64))])])])]))),128))])):v("",!0),t.uid?(c(),u("div",at,[n[7]||(n[7]=a("div",{class:"ui divider thin-only"},null,-1)),a("div",ot,[n[6]||(n[6]=a("label",null,"輸入留言",-1)),U(a("textarea",{"onUpdate:modelValue":n[1]||(n[1]=o=>t.newMessage=o)},null,512),[[V,t.newMessage]])]),a("div",{class:"ui primary submit button",onClick:n[2]||(n[2]=(...o)=>t.addMessage&&t.addMessage(...o))},"留言")])):v("",!0)])}const nt=O(q,[["render",it],["__scopeId","data-v-528d47a5"]]);export{nt as default};
